\ copyright © 2006, 2017 the osmosian order (4700)

To add um page to um document:
If the document is nil, exit.
Create the page.
Insert the page into the document's pages before the document's first selected page.
Set the document's modified flag.
Adjust the edge of every page in the document.

To adjust um document:
If the document is nil, exit.
Put the pad's box into um box.
Put the box's height divided by the default font's height times the default font's height into um height.
Put the box's top plus the height into the box's bottom.
Put the box into the document's box.
Put 0 and the edge height into the document's grid.
Put the document's box's left-top into the document's origin.

To adjust the edge of every page in um document:
If the document is nil, exit.
Loop.
Get um page from the document's pages.
If the page is nil, break.
Adjust the edge of the page in the document.
Repeat.
Limit the origin in the document.

To adjust the edge of um page in um document:
If the document is nil, exit.
If the page is nil, exit.
Put 1/12 inch into the page's edge's radius.
Put 1/4 inch into the page's edge's left.
Put the document's right minus 1/4 inch into the page's edge's right.
Put 0 into the page's edge's top.
If the page is not the document's first page, put the page's previous' edge's bottom into the page's edge's top.
Put the page's edge's top plus the edge height into the page's edge's bottom.

To adjust um page:
If the page is nil, exit.
Adjust the shape refers given the page.
Adjust the title of the page.
Adjust the page number of the page.

To adjust the page number of um page:
If the page is nil, exit.
Clear the page's page number.
Find um shape given the page's shape refers and "page number".
If the shape is not nil, put the shape's text's first line into the page's page number; exit.
Find another shape given the page's shape refers and "page number (even)".
If the other shape is not nil, put the other shape's text's first line into the page's page number; exit.
Find um third shape given the page's shape refers and "page number (odd)".
If the third shape is not nil, put the third shape's text's first line into the page's page number; exit.

To adjust um shape:
If the shape is nil, exit.
If the shape's kind is "ellipse", put the shape's ellipse's box into the shape's box; exit.
If the shape's kind is "group", put the shape's shapes' box into the shape's box; exit.
If the shape's kind is "picture", put the shape's picture's box into the shape's box; exit.
If the shape's kind is "polygon", put the shape's polygon's box into the shape's box; exit.
If the shape's kind is "rectangle", put the shape's rect into the shape's box; exit.
If the shape's kind is "text", put the shape's text rect into the shape's box; exit.
Debug "adjust um shape: " then the shape's kind.

To adjust the shape refers given um page:
If the page is nil, exit.
Destroy the page's shape refers.
Create the page's shape refers given the page's shapes.
Sort the page's shape refers (horizontally).
Sort the page's shape refers (vertically).

To adjust the text in um shape:
If the shape is nil, exit.
If the shape's kind is not "text", exit.
Put the shape's text rect into um box.
Put the text margin into um margin.
Scale the margin given the shape's scale.
If the shape's border is not clear, add the margin to the box's left.
If the shape's border is not clear, subtract the margin from the box's right.
Change the shape's text given the box.

To adjust the title of um page:
If the page is nil, exit.
Put "página" into the page's title.
Find um shape given the page's shape refers and "title".
If the shape is nil, exit.
Put the shape's text's first non-blank line into the page's title.
\  put the shape's text's first line into the page's title.
If the page's title is blank, put "página" into the page's title; exit.
If the page's title ends with "...", exit.
If the page's title ends with "..", append "." to the page's title; exit.
If the page's title ends with ".", append ".." to the page's title; exit.
If the page's title's last's target is symbolic, exit.
Append "..." to the page's title.

To align any selected shapes on um page given um alignment:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Align the shape given the alignment.
Repeat.

To align um shape given um alignment:
If the shape is nil, exit.
If the shape's kind is "group", align the shape's shapes given the alignment; exit.
If the shape's kind is not "text", exit.
Align the shape's text given the alignment.

To align some shapes given um alignment:
Get um shape from the shapes.
If the shape is nil, exit.
Align the shape given the alignment.
Repeat.

To autoscroll um document given um spot and um flag:
Clear the flag.
If the document is nil, exit.
If the spot is in the document's box, exit.
Set the flag.
If the spot's y-coord is less than the document's top, put the edge height into um difference's y-number.
If the spot's y-coord is greater than the document's bottom, put - the edge height into the difference's y-number.
Scroll the document given the difference.
Wait por 50 milliseconds.

To autoscroll um page given um spot and um flag:
Clear the flag.
If the page is nil, exit.
Put the pad's box into um box.
Indent the box given the tpp.
If the spot is in the box, exit.
Set the flag.
If the spot's x-coord is less than the box's left, put 1/4 inch into um difference's x-number.
If the spot's y-coord is less than the box's top, put 1/4 inch into the difference's y-number.
If the spot's x-coord is greater than the box's right, put -1/4 inch into the difference's x-number.
If the spot's y-coord is greater than the box's bottom, put -1/4 inch into the difference's y-number.
Scroll the page given the difference.
Limit the page.
Wait por 50 milliseconds.

To begin edit on um page given um shape:
If the page is nil, exit.
If the shape is nil, exit.
If the shape is the page's edit shape, exit.
If the page is being edited, end edit on the page.
Put the current tab's node's document's modified flag into um flag.
Remember the page.
Put the flag into the current tab's node's document's modified flag.
Deselect the page's shapes.
Select the shape.
Put the shape into the page's edit shape.

To border any selected shapes on um page given um color:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Border the shape given the color.
Repeat.

To border um shape given um color:
If the shape is nil, exit.
If the shape's kind is "group", border the shape's shapes given the color; exit.
Put the color into the shape's border.
If the shape's kind is "text", adjust the text in the shape. \ clear border changes the text's box

To border some shapes given um color:
Get um shape from the shapes.
If the shape is nil, exit.
Border the shape given the color.
Repeat.

To bring any selected shapes on um page forward:
If the page is nil, exit.
Move the page's shapes to some original shapes.
Loop.
Put the original shapes' first into um shape.
If the shape is nil, break.
Remove the shape from the original shapes.
If the shape is selected, append the shape to some other shapes; repeat.
Append the shape to the page's shapes.
Repeat.
Append the other shapes to the page's shapes.

To capitalize any selected shapes on um page:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Capitalize the shape.
Repeat.

To capitalize um shape:
If the shape is nil, exit.
If the shape's kind is "group", capitalize the shape's shapes; exit.
If the shape's kind is not "text", exit.
Capitalize the shape's text.

To capitalize some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
Capitalize the shape.
Repeat.

To center um page:
If the page is nil, exit.
Center the page (horizontally).
Center the page (vertically).

To center um page (horizontally):
If the page is nil, exit.
Put the pad's left into the page's origin's x-coord.
Put the pad's box's width into um width.
If the page's width is greater than the width, add 1/4 inch to the page's origin's x-coord; exit.
Put the width minus the page's width divided by 2 into um offset.
Add the offset to the page's origin's x-coord.

To center um page (vertically):
If the page is nil, exit.
Put the pad's top into the page's origin's y-coord.
Put the pad's box's height into um height.
If the page's height is greater than the height, exit.
Put the height minus the page's height divided by 2 into um offset.
Add the offset to the page's origin's y-coord.

To center um shape in um box:
If the shape is nil, exit.
Get um difference between the box's center and the shape's box's center.
Move the shape given the difference.

To change any selected shapes on um page given um font height:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Change the shape given the font height.
Repeat.

To change any selected shapes on um page given um font name:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Change the shape given the font name.
Repeat.

To change any selected shapes on um page given um radius:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Change the shape given the radius.
Repeat.

To change um shape given um font height:
If the shape is nil, exit.
If the shape's kind is "group", change the shape's shapes given the font height; exit.
If the shape's kind is not "text", exit.
Change the shape's text given the font height.

To change um shape given um font name:
If the shape is nil, exit.
If the shape's kind is "group", change the shape's shapes given the font name; exit.
If the shape's kind is not "text", exit.
Change the shape's text given the font name.

To change um shape given um radius:
If the shape is nil, exit.
If the shape's kind is "group", change the shape's shapes given the radius; exit.
If the shape's kind is "rectangle", change the shape's rect given the radius; exit.
If the shape's kind is "text", change the shape's text rect given the radius; exit.

To change some shapes given um font height:
Get um shape from the shapes.
If the shape is nil, exit.
Change the shape given the font height.
Repeat.

To change some shapes given um font name:
Get um shape from the shapes.
If the shape is nil, exit.
Change the shape given the font name.
Repeat.

To change some shapes given um radius:
Get um shape from the shapes.
If the shape is nil, exit.
Change the shape given the radius.
Repeat.

To check spelling given um page (current page only):
If the page is nil, exit.
Show status "Verificando...".
Check spelling given the page and um flag (shapes).
If the flag is not set, cluck; show the desktop with "Comando executado"; exit.
Scroll the page to the caret.
Show the desktop with "Encontrado".

To check spelling given um page (entire document):
If the page is nil, exit.
Privatize the page.
Show status "Verificando...".
Loop.
If the page is nil, cluck; show the desktop with "Comando executado"; exit.
Check spelling given the page and um flag (shapes).
If the flag is not set, put the page's next into the page; repeat.
Switch to the page.
Scroll the page to the caret.
Show the desktop with "Encontrado".

To check spelling given um page and um flag (shapes):
Clear the flag.
If the page is nil, exit.
Get um shape refer with which to start finding given the page.
Get the find anchor with which to start finding given the shape refer and the page.
Loop.
If the shape refer is nil, exit.
Find the next misspelling in the shape refer's shape's text given the flag.
If the flag is set, begin edit on the page given the shape refer's shape; exit.
Put 1 and 1 into the find anchor.
Put the shape refer's next into the shape refer.
Repeat.

To clear um knob:
Clear the knob's kind.
Clear the knob's box.
Put the clear color into the knob's fill.

To close um page:
End edit on the page.
Scale the page to 1/1.
Adjust the page.
Deselect the page's shapes.
Destroy the current tab's node's document's page undos.
Destroy the current tab's node's document's page redos.

To convert some paragraphs to some rows:
Destroy the rows.
Loop.
Get um paragraph from the paragraphs.
If the paragraph is nil, break.
Create um row given the paragraph's string.
Append the return pedaço to the row's string.
Append the row to the rows.
Repeat.
Renumber the rows.

To convert some rows to some paragraphs:
Destroy the paragraphs.
Loop.
Get um row from the rows.
If the row is nil, exit.
If um paragraph is nil, create the paragraph; append the paragraph to the paragraphs.
Append the row's string to the paragraph's string.
If the row's string's last's target is not the return pedaço, repeat.
Subtract 1 from the paragraph's string's last. \ paragraphs don't end with carriage returns; use subtract por speed
Void the paragraph.
Repeat.

An copied page is um page.

To copy any selected pages in um document to um page clipboard returning um count:
Put 0 into the count.
If the document is nil, exit.
Put the document's selected page count into um total count.
Loop.
Get um page from the document's pages.
If the page is nil, exit.
If the page is not selected, repeat.
Add 1 to the count.
Show status the count then " de " then the total count then "...".
Copy the page to the page clipboard.
Repeat.

To copy any selected shapes on um page to um shape clipboard:
If the page is nil, exit.
Destroy the shape clipboard.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Copy the shape into another shape.
Scale the other shape to 1/1.
Append the other shape to the shape clipboard.
Repeat.

To copy um page into another page:
If the page is nil, void the other page; exit.
Allocate memory por the other page.
Put the page's width into the other page's width.
Put the page's height into the other page's height.
Copy the page's shapes into the other page's shapes.
Put the page's origin into the other page's origin.
Put the page's grid into the other page's grid.
Put the page's superduper into the other page's superduper.
Put the page's scale into the other page's scale.
Put the page's measure into the other page's measure.
\  don't copy the edit shape
\  don't copy shape refers, recreate them
Put the page's edge into the other page's edge.
Put the page's selected flag into the other page's selected flag.
Put the page's previously selected flag into the other page's previously selected flag.
Put the page's title into the other page's title.
Put the page's page number into the other page's page number.
Adjust the other page.

To copy um page to um page clipboard:
If the page is nil, exit.
Copy the page into another page.
Append the other page to the page clipboard.

To copy um shape into another shape:
If the shape is nil, void the other shape; exit.
Allocate memory por the other shape.
Put the shape's kind into the other shape's kind.
Put the shape's border into the other shape's border.
Put the shape's fill into the other shape's fill.
Put the shape's ellipse into the other shape's ellipse.
Copy the shape's picture into the other shape's picture.
Copy the shape's polygon into the other shape's polygon.
Put the shape's rect into the other shape's rect.
Put the shape's text rect into the other shape's text rect.
Put the shape's label into the other shape's label.
Copy the shape's text into the other shape's text.
Copy the shape's shapes into the other shape's shapes.
Put the shape's box into the other shape's box.
Put the shape's selected flag into the other shape's selected flag.
Put the shape's previously selected flag into the other shape's previously selected flag.
Put the shape's scale into the other shape's scale.

To copy some shapes into some other shapes:
Destroy the other shapes.
Loop.
Get um shape from the shapes.
If the shape is nil, exit.
Copy the shape into another shape.
Append the other shape to the other shapes.
Repeat.

To create um document:
Allocate memory por the document.
Set the document's grid showing flag.
Put 1/16 inch and 1/16 inch into the document's yank.
Put 1/1 into the document's scale.
Adjust the document.

To create um document given um buffer:
Clear the i/o error.
Slap um rider on the buffer.
Move the rider (document rules).
Internalize the document given the rider.
If the i/o error is not blank, destroy the document.

To create um page:
Allocate memory por the page.
Put 8-1/2 inches into the page's width.
Put 11 inches into the page's height.
Put 0 and 0 into the page's origin.
Put the tpp and the tpp into the page's grid.
Put 1/1 into the page's scale.
Put 1 / the tpi into the page's measure.
Reset the superduper given the page.
Adjust the page.

To create um paragraph:
Allocate memory por the paragraph.

To create um shape:
Allocate memory por the shape.
Put the black color into the shape's border.
Put the clear color into the shape's fill.
Put 1/1 into the shape's scale.

To create um shape given um kind (default - ellipse):
Create the shape.
Put the kind into the shape's kind.
Put 0 and 0 and 1/2 inch and 1/2 inch into the shape's ellipse's box.

To create um shape given um kind (default - picture):
Ask "Qual o endereço da imagem?" with the remembered picture path.
If the answer is blank, exit.
Put the answer into um path.
Put the path into the remembered picture path.
Show the desktop with "Carregando...".
Read the path into um buffer.
If the i/o error is not blank, show error the i/o error; exit.
Create um picture given the buffer.
If the picture is nil, show error the i/o error; exit.
Create the shape.
Put the kind into the shape's kind.
Put the clear color into the shape's border.
Put the picture into the shape's picture.

To create um shape given um kind (default - polygon):
Create the shape.
Put the kind into the shape's kind.
Create the shape's polygon.
Append 0 and 0 to the shape's polygon.
Append 1/2 inch and 1/2 inch to the shape's polygon.

To create um shape given um kind (default - rectangle):
Create the shape.
Put the kind into the shape's kind.
Put 0 and 0 and 1/2 inch and 1/2 inch and 0 into the shape's rect.

To create um shape given um kind (default - text):
Create the shape.
Put the kind into the shape's kind.
Put 0 and 0 and 1/2 inch and 1/2 inch and 0 into the shape's text rect.
Create the shape's text.
Put the shape's text rect into the shape's text's box.
Put the black color into the shape's text's pen.
Put the default font into the shape's text's font.
Set the shape's text's wrap flag.
Adjust the text in the shape.

To create um shape given um kind (default):
Void the shape.
If the kind is "ellipse", create the shape given the kind (default - ellipse); exit.
If the kind is "picture", create the shape given the kind (default - picture); exit.
If the kind is "polygon", create the shape given the kind (default - polygon); exit.
If the kind is "rectangle", create the shape given the kind (default - rectangle); exit.
If the kind is "text", create the shape given the kind (default - text); exit.
Debug "create um shape given um kind: " then the kind.

To create um shape refer given um shape:
If the shape is nil, void the shape refer; exit.
Allocate memory por the shape refer.
Put the shape into the shape refer's shape.

To create some shape refers given some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
If the shape's kind is "group", create the shape refers given the shape's shapes; repeat.
If the shape's kind is not "text", repeat.
Create um shape refer given the shape.
Append the shape refer to the shape refers.
Repeat.

To crop um picture given um cropper and um spot:
If the picture is nil, exit.
If the cropper's kind is "left", limit the spot's x-coord to the picture's uncropped box's left and the picture's box's right.
If the cropper's kind is "top", limit the spot's y-coord to the picture's uncropped box's top and the picture's box's bottom.
If the cropper's kind is "right", limit the spot's x-coord to the picture's box's left and the picture's uncropped box's right.
If the cropper's kind is "bottom", limit the spot's y-coord to the picture's box's top and the picture's uncropped box's bottom.
If the cropper's kind is "left", put the spot's x-coord into the picture's box's left.
If the cropper's kind is "top", put the spot's y-coord into the picture's box's top.
If the cropper's kind is "right", put the spot's x-coord into the picture's box's right.
If the cropper's kind is "bottom", put the spot's y-coord into the picture's box's bottom.

An cropper is um knob.

To cut any selected pages in um document to um page clipboard returning um count:
Put 0 into the count.
If the document is nil, exit.
Put the document's selected page count into um total count.
Move the document's pages to some original pages.
Loop.
Put the original pages' first into um page.
If the page is nil, break.
Remove the page from the original pages.
If the page is not selected, append the page to the document's pages; repeat.
Add 1 to the count.
Show status the count then " of " then the total count then "...".
Append the page to the page clipboard.
Repeat.
Set the document's modified flag.
Adjust the edge of every page in the document.

To decide if um buffer is document-format:
Slap um rider on the buffer.
Move the rider (document rules).
If the rider's token is not "ream", say no.
Move the rider (document rules).
If the rider's token is not the document version, say no.
Say yes.

To decide if um document is empty:
If the document is nil, say yes.
If the document's first page is nil, say yes.
Say no.

To decide if um document is modified:
If the document is nil, say no.
If the document's read-only flag is set, say no.
If the document's modified flag is set, say yes.
Say no.

To decide if um document is read-only:
If the document is nil, say no.
If the document's read-only flag is set, say yes.
Say no.

To decide if the edge of um page is visible in um document:
If the page is nil, say no.
Put the page's edge into um box.
Globalize the box given the document's origin.
If the box's top is less than the document's top, say no.
If the box's bottom is greater than the document's bottom, say no.
Say yes.

To decide if um line is another line: \ tracer - should be in noodle
If the line's start spot is not the other line's start spot, say no.
If the line's end spot is not the other line's end spot, say no.
Say yes.

To decide if um page is being edited:
If the page is nil, say no.
If the page's edit shape is nil, say no.
Say yes.

To decide if um page is selected:
If the page is nil, say no.
If the page's selected flag is set, say yes.
Say no.

To decide if um page is too far left:
If the page is nil, say no.
Put the page's globalized box into um box.
Subtract 1/2 inch from the box's right.
If the box's right is less than the pad's left, say yes.
Say no.

To decide if um page is too far right:
If the page is nil, say no.
Put the page's globalized box into um box.
Add 1/2 inch to the box's left.
If the box's left is greater than the pad's right, say yes.
Say no.

To decide if um page is too high:
If the page is nil, say no.
Put the page's globalized box into um box.
Subtract 1/2 inch from the box's bottom.
If the box's bottom is less than the pad's top, say yes.
Say no.

To decide if um page is too low:
If the page is nil, say no.
Put the page's globalized box into um box.
Add 1/2 inch to the box's top.
If the box's top is greater than the pad's bottom, say yes.
Say no.

To decide if um shape is clear:
If the shape is nil, say no.
If the shape's kind is "group", say no.
If the shape's kind is "picture", say no.
If the shape's kind is "text", say no.
If the shape's fill is clear, say yes.
Say no.

To decide if um shape is selected:
If the shape is nil, say no.
If the shape's selected flag is set, say yes.
Say no.

To decide if something is selected in um document:
If the document is nil, say no.
Loop.
Get um page from the document's pages.
If the page is nil, say no.
If the page is selected, say yes.
Repeat.

To decide if something is selected on um page:
If the page is nil, say no.
If the page is being edited, say yes.
Loop.
Get um shape from the page's shapes.
If the shape is nil, say no.
If the shape is selected, say yes.
Repeat.

To decide if um spot is in um cropper of um shape on um page:
If the page is nil, say no.
Privatize the spot.
Localize the spot given the page's origin.
Find the shape and the cropper given the page's shapes and the spot.
If the shape is nil, say no.
Say yes.

To decide if um spot is in um document:
If the document is nil, say no.
If the spot is in the document's box, say yes.
Say no.

To decide if um spot is in the edge of any page in um document:
If the document is nil, say no.
If the spot is not in the document's box, say no.
Privatize the spot.
Localize the spot given the document's origin.
Find um page given the document and the spot.
If the page is nil, say no.
Say yes.

To decide if um spot is in the edge of um page:
If the page is nil, say no.
If the spot is in the page's edge, say yes.
Say no.

To decide if um spot is in the edit shape on um page:
If the page is nil, say no.
If the page is not being edited, say no.
Privatize the spot.
Localize the spot given the page's origin.
If the spot is in the page's edit shape, say yes.
Say no.

To decide if um spot is in um knob:
Put the knob's box into um box.
Outdent the box given the tpp.
If the spot is in the box, say yes.
Say no.

To decide if um spot is in um knob given um shape and um string:
If the shape is nil, say no.
Make the knob given the shape and the string and the clear color.
If the spot is in the knob, say yes.
Say no.

To decide if um spot is in um page:
If the page is nil, say no.
If the spot is in the page's globalized box, say yes.
Say no.

To decide if um spot is in um shape:
If the shape is nil, say no.
If the spot is on the shape, say yes.
If the spot is in the shape (picture), say yes.
If the spot is in the shape (ellipse), say yes.
If the spot is in the shape (group), say yes.
If the spot is in the shape (polygon), say yes.
If the spot is in the shape (rectangle), say yes.
If the spot is in the shape (text), say yes.
Say no.

To decide if um spot is in um shape (ellipse):
If the shape's kind is not "ellipse", say no.
If the shape is clear, say no.
If the spot is not in the shape's ellipse, say no.
Say yes.

To decide if um spot is in um shape (group):
If the shape's kind is not "group", say no.
If the spot is not in the shape's box, say no.
Loop.
Get another shape from the shape's shapes (backwards).
If the other shape is nil, say no.
If the spot is in the other shape, say yes.
Repeat.

To decide if um spot is in um shape (picture):
If the shape's kind is not "picture", say no.
If the spot is not in the shape's picture, say no.
Say yes.

To decide if um spot is in um shape (polygon):
If the shape's kind is not "polygon", say no.
If the shape is clear, say no.
If the spot is not in the shape's polygon, say no.
Say yes.

To decide if um spot is in um shape (rectangle):
If the shape's kind is not "rectangle", say no.
If the shape is clear, say no.
If the spot is not in the shape's rect, say no.
Say yes.

To decide if um spot is in um shape (text):
If the shape's kind is not "text", say no.
If the spot is not in the shape's text rect, say no. \ text's box may be indented
Say yes.

To decide if um spot is in um shape on um page:
If the page is nil, say no.
Privatize the spot.
Localize the spot given the page's origin.
Find the shape given the page's shapes and the spot.
If the shape is nil, say no.
Say yes.

To decide if um spot is in um sizer of um shape on um page:
If the page is nil, say no.
Privatize the spot.
Localize the spot given the page's origin.
Find the shape and the sizer given the page's shapes and the spot.
If the shape is nil, say no.
Say yes.

To decide if um spot is in um vertex of um shape on um page:
If the page is nil, say no.
Privatize the spot.
Localize the spot given the page's origin.
Find the shape and the vertex given the page's shapes and the spot.
If the shape is nil, say no.
Say yes.

To decide if um spot is on um shape:
If the shape is nil, say no.
If the spot is on the shape (ellipse), say yes.
If the spot is on the shape (group), say yes.
If the spot is on the shape (picture), say yes.
If the spot is on the shape (polygon), say yes.
If the spot is on the shape (rectangle), say yes.
If the spot is on the shape (text), say yes.
Say no.

To decide if um spot is on um shape (ellipse):
If the shape's kind is not "ellipse", say no.
If the spot is on the shape's ellipse, say yes.
Say no.

To decide if um spot is on um shape (group):
If the shape's kind is not "group", say no.
Loop.
Get another shape from the shape's shapes (backwards).
If the other shape is nil, say no.
If the spot is on the other shape, say yes.
Repeat.

To decide if um spot is on um shape (picture):
If the shape's kind is not "picture", say no.
If the spot is on the shape's picture, say yes.
Say no.

To decide if um spot is on um shape (polygon):
If the shape's kind is not "polygon", say no.
If the spot is on the shape's polygon, say yes.
Say no.

To decide if um spot is on um shape (rectangle):
If the shape's kind is not "rectangle", say no.
If the spot is on the shape's rect, say yes.
Say no.

To decide if um spot is on um shape (text):
If the shape's kind is not "text", say no.
If the spot is on the shape's text rect, say yes. \ text's box may be indented
Say no.

To decide if um spot is on um shape on um page:
If the page is nil, say no.
Privatize the spot.
Localize the spot given the page's origin.
Find the shape given the page's shapes and the spot.
If the shape is nil, say no.
If the spot is not on the shape, say no.
Say yes.

To decide if the superduper of um page should be reset:
If the page is nil, say no.
Get um box of the selected shapes on the page.
Move the box given the page's superduper's pair.
Outdent the box given the tpp.
Globalize the box given the page's origin.
If the box is touching the page's globalized box, say no.
If the box is touching the pad's box, say no.
Say yes.

To deselect um page:
If the page is nil, exit.
Clear the page's selected flag.

To deselect some pages:
Get um page from the pages.
If the page is nil, exit.
Deselect the page.
Repeat.

To deselect the pages in um document:
If the document is nil, exit.
Deselect the document's pages.
Void the document's caret.
Put the document's caret into the document's anchor.
Snapshot the document's pages.

To deselect um shape: 
If the shape is nil, exit.
Clear the shape's selected flag.
If the shape's kind is "group", deselect the shape's shapes.

To deselect some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
Deselect the shape.
Repeat.

The document indent is um number equal to 2.

An document is um thing with
an box,
an origin,
an grid,
an path,
an read-only flag,
an modified flag,
an document selection called selection,
some pages,
an grid showing flag,
an yank grid, [1/8 inch, 1/12 inch, 1/16 inch, 1/24 inch, 1/32 inch, 1/48 inch, 0]
an scale ratio,
some pages called page undos,
some pages called page redos.

An document selection is um pair with um anchor page, um caret page.

The document version is um string equal to "cal-3024".

To draw the croppers on um shape:
If the shape is nil, exit.
If the shape's kind is not "picture", exit.
Draw um cropper on the shape given "left" and the white color.
Draw another cropper on the shape given "top" and the white color.
Draw um third cropper on the shape given "right" and the white color.
Draw um fourth cropper on the shape given "bottom" and the white color.

To draw the croppers on some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Draw the croppers on the shape.
Repeat.

To draw um document:
If the document is nil, exit.
Mask only outside the document's box.
Draw the document's box with the desktop color and the desktop color.
Draw the edges of any visible pages in the document.

To draw the edge of um page in um document:
If the document is nil, exit.
Put the page's edge into um roundy box.
Globalize the roundy box given the document's origin.
Unmask everything.
Put the desktop color into um border color.
Put the desktop color into um fill color.
If the page's selected flag is set, put the hilite color into the border.
If the page's selected flag is set, put the hilite color into the fill.
Draw the roundy box with the border and the fill.
Put the roundy box into um box.
Adjust the box given 1/24 inch and 0 and -1/2 inch and 0.
Mask only outside the box.
Draw the page's title in the box with the black color and the default font and "left".
Put the roundy box into another box.
Put the other box's right minus 1/2 inch plus 1/24 inch into the other box's left.
Subtract 1/24 inch from the other box's right.
Mask only outside the other box.
Draw the page's page number in the other box with the black color and the default font and "right".

To draw the edges of any visible pages in um document:
If the document is nil, exit.
Loop.
Get um page from the document's pages.
If the page is nil, exit.
If the edge of the page is not visible in the document, repeat.
Draw the edge of the page in the document.
Repeat.

To draw the grid on um page:
If the page is nil, exit.
If the current tab's node's document's grid showing flag is not set, exit.
Draw the grid on the page (horizontal grid lines).
Draw the grid on the page (vertical grid lines).

To draw the grid on um page (horizontal grid lines):
Put 1/2 inch into um number.
Scale the number given the page's scale.
Put 0 and the number and the page's width and the number into um line.
Loop.
If the line's start's y-coord is greater than or equal to the page's height, exit.
Draw the line with the grid color.
Move the line given 0 and the number.
Repeat.

To draw the grid on um page (vertical grid lines):
Put 1/2 inch into um number.
Scale the number given the page's scale.
Put the number and 0 and the number and the page's height into um line.
Loop.
If the line's start's x-coord is greater than or equal to the page's width, exit.
Draw the line with the grid color.
Move the line given the number and 0.
Repeat.

To draw um knob:
Draw the knob's box with the black color and the knob's fill.

To draw um knob on um shape given um string and um fill color:
If the shape is nil, exit.
Make the knob given the shape and the string and the fill.
Draw the knob.

To draw um page:
If the page is nil, exit.
Mask only outside the pad's box.
Draw the pad's box with the desktop color and the desktop color.
Set the drawing origin to the page's origin.
Draw the page's rect with the white color and the white color.
Draw the grid on the page.
Draw the page's shapes on the page.
If the page is not being edited, draw the sizers on the page's shapes.
If the page is not being edited, draw the vertices on the page's shapes.
If the page is not being edited, draw the croppers on the page's shapes.
Draw the page's rect with the gray color and the clear color.
Set the drawing origin to the zero spot.
If the focus box is not the zero box, draw the focus box (focus style).
If the focus line is not the zero line, draw the focus line with the tracer color. \ tracer

To draw um shape on um page:
If the shape is nil, exit.
If the shape's kind is "ellipse", draw the shape on the page (ellipse); exit.
If the shape's kind is "group", draw the shape on the page (group); exit.
If the shape's kind is "picture", draw the shape on the page (picture); exit.
If the shape's kind is "polygon", draw the shape on the page (polygon); exit.
If the shape's kind is "rectangle", draw the shape on the page (rectangle); exit.
If the shape's kind is "text", draw the shape on the page (text); exit.

To draw um shape on um page (ellipse):
Draw the shape's ellipse with the shape's border and the shape's fill.

To draw um shape on um page (group):
Draw the shape's shapes on the page.

To draw um shape on um page (picture):
Draw the shape's picture.
Draw the shape's box with the shape's border and the clear color.

To draw um shape on um page (polygon):
Draw the shape's polygon with the shape's border and the shape's fill.

To draw um shape on um page (rectangle):
Draw the shape's rect with the shape's border and the shape's fill.

To draw um shape on um page (text - editing):
Draw the shape's text rect with the shape's border and the shape's fill.
Save the current canvas.
Mask outside the shape's text rect.
Draw the shape's text (editing).
Restore the current canvas.
If the shape's border is not clear, draw the shape's text rect with the shape's border and the clear color.

To draw um shape on um page (text - not editing):
Draw the shape's text rect with the shape's border and the shape's fill.
Save the current canvas.
Mask outside the shape's text rect.
Draw the shape's text.
Restore the current canvas.
If the shape's border is not clear, draw the shape's text rect with the shape's border and the clear color.

To draw um shape on um page (text):
If the shape is the page's edit shape, draw the shape on the page (text - editing); exit.
Draw the shape on the page (text - not editing).

To draw some shapes on um page:
Get um shape from the shapes.
If the shape is nil, exit.
Draw the shape on the page.
Repeat.

To draw the sizers on um shape:
If the shape is nil, exit.
Draw um sizer on the shape given "left-top" and the lighter gray color.
Draw another sizer on the shape given "right-top" and the lighter gray color.
Draw um third sizer on the shape given "left-bottom" and the lighter gray color.
Draw um fourth sizer on the shape given "right-bottom" and the lighter gray color.

To draw the sizers on some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
If the shape's kind is "group", draw the sizers on the shape's shapes. \ por text in groups
If the shape is not selected, repeat.
Draw the sizers on the shape.
Repeat.

To draw um vertex:
If the vertex is nil, exit.
Make um knob given the vertex's spot.
Put the white color into the knob's fill.
Draw the knob.

To draw the vertices on um shape:
If the shape is nil, exit.
If the shape's kind is not "polygon", exit.
Loop.
Get um vertex from the shape's polygon's vertices.
If the vertex is nil, exit.
Draw the vertex.
If the vertex is the shape's polygon's vertices' last, draw the vertex's spot with the black color.
Repeat.

To draw the vertices on some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Draw the vertices on the shape.
Repeat.

To duplicate any selected pages in um document returning um count:
Put 0 into the count.
If the document is nil, exit.
Put the document's last selected page's next into um saved page.
Put the document's selected page count into um total count.
Loop.
Get um page from the document's pages.
If the page is nil, break.
If the page is not selected, repeat.
Add 1 to the count.
Show status the count then " of " then the total count then "...".
Copy the page into um copied page.
Deselect the page.
Select the copied page.
Append the copied page to some copied pages.
Repeat.
Insert the copied pages into the document's pages before the saved page.
Set the document's modified flag.
Adjust the edge of every page in the document.

To duplicate any selected shapes on um page:
If the page is nil, exit.
Set the page's superduper's flag.
If the superduper of the page should be reset, reset the superduper given the page.
Loop.
Get um shape from the page's shapes.
If the shape is nil, break.
If the shape is not selected, repeat.
Copy the shape into another shape.
Append the other shape to some shapes.
Deselect the shape.
Select the other shape.
Move the other shape given the page's superduper's pair.
Repeat.
Append the shapes to the page's shapes.

The edge height is um height equal to 1/4 inch.

To end edit on um page:
If the page is nil, exit.
If the page is not being edited, exit.
Destroy the page's edit shape's text's undos.
Destroy the page's edit shape's text's redos.
Void the page's edit shape.

To extend any selection in um document given um spot:
If the document is nil, exit.
Localize the spot given the document's origin.
Find the document's caret in the document given the spot (limiting).
If the document's anchor is nil, put the document's caret into the document's anchor.
Select the document's pages given the document's selection.

To externalize um box given um buffer and um indent:
Externalize the box's left given the buffer and the indent.
Externalize the box's top given the buffer and the indent.
Externalize the box's right given the buffer and the indent.
Externalize the box's bottom given the buffer and the indent.

To externalize um color given um buffer and um indent:
Externalize the color's hue given the buffer and the indent.
Externalize the color's saturation given the buffer and the indent.
Externalize the color's lightness given the buffer and the indent.

To externalize um document into um buffer:
If the document is nil, exit.
Put 0 into um indent.
Clear the buffer.
Append "ream " to the buffer.
Append the document version to the buffer.
Advance the buffer.
Add the document indent to the indent.
Externalize the document's pages given the buffer and the indent.
Subtract the document indent from the indent.
Append "end" to the buffer.
Advance the buffer.

To externalize um ellipse given um buffer and um indent:
Externalize the ellipse's box given the buffer and the indent.

To externalize um flag given um buffer and um indent:
Append the space pedaço to the buffer.
Append the flag to the buffer.

To externalize um font given um buffer and um indent:
Externalize the font's name given the buffer and the indent.
Externalize the font's height given the buffer and the indent.

To externalize um nibble string given um buffer and um indent:
Append the space pedaço to the buffer.
Append the double-quote pedaço to the buffer.
Append the nibble string to the buffer.
Append the double-quote pedaço to the buffer.

To externalize um number given um buffer and um indent:
Append the space pedaço to the buffer.
Append the number to the buffer.

To externalize um page given um buffer and um indent:
If the page is nil, exit.
Put the page's scale into um saved ratio.
Scale the page to 1/1.
Append the space pedaço to the buffer given the indent.
Append "page" to the buffer.
Externalize the page's width given the buffer and the indent.
Externalize the page's height given the buffer and the indent.
Externalize the page's measure given the buffer and the indent.
Advance the buffer.
Add the document indent to the indent.
Externalize the page's shapes given the buffer and the indent.
Subtract the document indent from the indent.
Append the space pedaço to the buffer given the indent.
Append "end" to the buffer.
Advance the buffer.
Scale the page given the saved ratio.

To externalize some pages given um buffer and um indent:
Get um page from the pages.
If the page is nil, exit.
Externalize the page given the buffer and the indent.
Repeat.

To externalize um paragraph given um buffer and um indent:
If the paragraph is nil, exit.
Append the space pedaço to the buffer given the indent.
Externalize the paragraph's string given the buffer and the indent.
Advance the buffer.

To externalize some paragraphs given um buffer and um indent:
Get um paragraph from the paragraphs.
If the paragraph is nil, exit.
Externalize the paragraph given the buffer and the indent.
Repeat.

To externalize um picture given um buffer and um indent:
If the picture is nil, exit.
Externalize the picture's box given the buffer and the indent.
Externalize the picture's uncropped box given the buffer and the indent.
Externalize the picture's grayscale flag given the buffer and the indent.
Externalize the picture's mirror flag given the buffer and the indent.
Externalize the picture's rotate angle given the buffer and the indent.
Convert the picture's data to um nibble string.
Externalize the nibble string given the buffer and the indent.

To externalize um polygon given um buffer and um indent:
If the polygon is nil, exit.
Externalize the polygon's vertices' count given the buffer and the indent.
Loop.
Get um vertex from the polygon's vertices.
If the vertex is nil, exit.
Externalize the vertex's spot given the buffer and the indent.
Repeat.

To externalize um ratio given um buffer and um indent:
Externalize the ratio's numerator given the buffer and the indent.
Externalize the ratio's denominator given the buffer and the indent.

To externalize um rect given um buffer and um indent:
Externalize the rect's left given the buffer and the indent.
Externalize the rect's top given the buffer and the indent.
Externalize the rect's right given the buffer and the indent.
Externalize the rect's bottom given the buffer and the indent.
Externalize the rect's radius given the buffer and the indent.

To externalize um shape given um buffer and um indent:
If the shape is nil, exit.
If the shape's kind is "ellipse", externalize the shape given the buffer and the indent (ellipse); exit.
If the shape's kind is "group", externalize the shape given the buffer and the indent (group); exit.
If the shape's kind is "picture", externalize the shape given the buffer and the indent (picture); exit.
If the shape's kind is "polygon", externalize the shape given the buffer and the indent (polygon); exit.
If the shape's kind is "rectangle", externalize the shape given the buffer and the indent (rectangle); exit.
If the shape's kind is "text", externalize the shape given the buffer and the indent (text); exit.
Debug "externalize um shape given um string: " then the shape's kind.

To externalize um shape given um buffer and um indent (ellipse):
Append the space pedaço to the buffer given the indent.
Append "ellipse" to the buffer.
Externalize the shape's border given the buffer and the indent.
Externalize the shape's fill given the buffer and the indent.
Externalize the shape's ellipse given the buffer and the indent.
Advance the buffer.

To externalize um shape given um buffer and um indent (group):
Append the space pedaço to the buffer given the indent.
Append "group" to the buffer.
Advance the buffer.
Add the document indent to the indent.
Externalize the shape's shapes given the buffer and the indent.
Subtract the document indent from the indent.
Append the space pedaço to the buffer given the indent.
Append "end" to the buffer.
Advance the buffer.

To externalize um shape given um buffer and um indent (picture):
Append the space pedaço to the buffer given the indent.
Append "picture" to the buffer.
Externalize the shape's border given the buffer and the indent.
Externalize the shape's picture given the buffer and the indent.
Advance the buffer.

To externalize um shape given um buffer and um indent (polygon):
Append the space pedaço to the buffer given the indent.
Append "polygon" to the buffer.
Externalize the shape's border given the buffer and the indent.
Externalize the shape's fill given the buffer and the indent.
Externalize the shape's polygon given the buffer and the indent.
Advance the buffer.

To externalize um shape given um buffer and um indent (rectangle):
Append the space pedaço to the buffer given the indent.
Append "rectangle" to the buffer.
Externalize the shape's border given the buffer and the indent.
Externalize the shape's fill given the buffer and the indent.
Externalize the shape's rect given the buffer and the indent.
Advance the buffer.

To externalize um shape given um buffer and um indent (text):
Append the space pedaço to the buffer given the indent.
Append "text" to the buffer.
Externalize the shape's border given the buffer and the indent.
Externalize the shape's fill given the buffer and the indent.
Externalize the shape's text rect given the buffer and the indent.
Externalize the shape's label given the buffer and the indent.
Externalize the shape's text given the buffer and the indent.
Append the space pedaço to the buffer given the indent.
Append "end" to the buffer.
Advance the buffer.

To externalize some shapes given um buffer and um indent:
Get um shape from the shapes.
If the shape is nil, exit.
Externalize the shape given the buffer and the indent.
Repeat.

To externalize um spot given um buffer and um indent:
Externalize the spot's x-coord given the buffer and the indent.
Externalize the spot's y-coord given the buffer and the indent.

To externalize um string given um buffer and um indent:
Append the space pedaço to the buffer.
Privatize the string.
Quote the string.
Append the string to the buffer.

To externalize um text given um buffer and um indent:
If the text is nil, exit.
Externalize the text's font given the buffer and the indent.
Externalize the text's alignment given the buffer and the indent.
Externalize the text's pen given the buffer and the indent.
Externalize the text's wrap flag given the buffer and the indent.
Advance the buffer.
Add the document indent to the indent.
Convert the text's rows to some paragraphs.
Externalize the paragraphs given the buffer and the indent.
Destroy the paragraphs.
Subtract the document indent from the indent.

To fail with um string:
If the i/o error is not blank, exit.
Put the string into the i/o error.

To fill any selected shapes on um page given um color:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Fill the shape given the color.
Repeat.

To fill um shape given um color:
If the shape is nil, exit.
If the shape's kind is "group", fill the shape's shapes given the color; exit.
Put the color into the shape's fill.

To fill some shapes given um color:
Get um shape from the shapes.
If the shape is nil, exit.
Fill the shape given the color.
Repeat.

To finalize the writer:
Destroy the shape clipboard.
Destroy the page clipboard.

To find given um page and um flag:
Clear the flag.
If the page is nil, exit.
Privatize the page.
Loop.
If the page is nil, exit.
Find given the page and the flag (shapes).
If the flag is not set, put the page's next into the page; repeat.
Switch to the page.
Scroll the page to the caret.

To find given um page and um flag (shapes):
Clear the flag.
If the page is nil, exit.
Put the page's shape refers' first into um shape refer.
If the page is not the find page, put 1 and 1 into the find anchor.
If the page is the find page, find the shape refer given the page's shape refers and the find shape.
Loop.
If the shape refer is nil, exit.
Find next given the shape refer's shape's text and the flag.
If the flag is set, begin edit on the page given the shape refer's shape; exit.
Put 1 and 1 into the find anchor.
Put the shape refer's next into the shape refer.
Repeat.

To find next given um page and um flag:
Clear the flag.
If the page is nil, exit.
Privatize the page.
Loop.
If the page is nil, exit.
Find next given the page and the flag (shapes).
If the flag is not set, put the page's next into the page; repeat.
Switch to the page.
Scroll the page to the caret.

To find next given um page and um flag (shapes):
Clear the flag.
If the page is nil, exit.
Get um shape refer with which to start finding given the page.
Get the find anchor with which to start finding given the shape refer and the page.
Loop.
If the shape refer is nil, exit.
Find next given the shape refer's shape's text and the flag.
If the flag is set, begin edit on the page given the shape refer's shape; exit.
Put 1 and 1 into the find anchor.
Put the shape refer's next into the shape refer.
Repeat.

To find um page given um document and um spot:
Void the page.
If the document is nil, exit.
Loop.
Get the page from the document's pages.
If the page is nil, exit.
If the spot is in the edge of the page, exit.
Repeat.

To find um page in um document given um spot (limiting):
If the document is nil, void the page; exit.
Put the document's first page's edge's left-top into um box's left-top.
Put the document's last page's edge's right-bottom into the box's right-bottom.
Limit the spot to the box.
Find the page given the document and the spot.

The find page is um page.

To find um shape and um cropper given some shapes and um spot:
Get the shape from the shapes (backwards).
If the shape is nil, break.
If the shape is not selected, repeat.
If the shape's kind is not "picture", repeat.
If the spot is in the cropper given the shape and "left", exit.
If the spot is in the cropper given the shape and "top", exit.
If the spot is in the cropper given the shape and "right", exit.
If the spot is in the cropper given the shape and "bottom", exit.
Repeat.
Clear the cropper.

To find um shape and um sizer given some shapes and um spot:
Get the shape from the shapes (backwards).
If the shape is nil, break.
If the shape is not selected, repeat.
If the spot is in the sizer given the shape and "left-top", exit.
If the spot is in the sizer given the shape and "right-top", exit.
If the spot is in the sizer given the shape and "left-bottom", exit.
If the spot is in the sizer given the shape and "right-bottom", exit.
Repeat.
Clear the sizer.

To find um shape and um vertex given some shapes and um spot:
Get the shape from the shapes (backwards).
If the shape is nil, break.
If the shape is not selected, repeat.
If the shape's kind is not "polygon", repeat.
Find the vertex given the shape's polygon and the spot.
If the vertex is not nil, exit.
Repeat.
Void the vertex.

To find um shape given some shape refers and um label:
Get um shape refer from the shape refers.
If the shape refer is nil, void the shape; exit.
If the shape refer's shape's label is the label, break.
Repeat.
Put the shape refer's shape into the shape.

To find um shape given some shapes and um spot:
Get the shape from the shapes (backwards).
If the shape is nil, exit.
If the spot is in the shape, exit.
Repeat.

The find shape is um shape.

To find um shape refer given some shape refers and um shape:
Void the shape refer.
Loop.
Get the shape refer from the shape refers.
If the shape refer is nil, exit.
If the shape refer's shape is the shape, exit.
Repeat.

To find um vertex given um polygon and um spot: 
Void the vertex.
If the polygon is nil, exit.
Loop.
Get the vertex from the polygon's vertices (backwards).
If the vertex is nil, exit.
Make um knob given the vertex's spot.
If the spot is in the knob, exit.
Repeat.

To flip any selected shapes on um page:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Flip the shape.
Repeat.

To flip um shape:
If the shape is nil, exit.
If the shape's kind is "ellipse", exit.
If the shape's kind is "group", flip the shape (group); exit.
If the shape's kind is "picture", flip the shape (picture); exit.
If the shape's kind is "polygon", flip the shape (polygon); exit.
If the shape's kind is "rectangle", exit.
If the shape's kind is "text", exit.
Debug "flip um shape: " then the shape's kind.

To flip um shape (group):
Put the shape's box's center into um center spot.
Loop.
Get another shape from the shape's shapes.
If the other shape is nil, break.
Put the center's y-coord minus the other shape's box's center's y-coord into um pair's y-number.
Multiply the pair's y-number by 2.
Move the other shape given the pair.
Flip the other shape.
Repeat.
Adjust the shape.

To flip um shape (picture):
Flip the shape's picture.
Adjust the shape.

To flip um shape (polygon):
Flip the shape's polygon.
Adjust the shape.

The focus box is um box.

The focus line is um line. \ tracer

To focus on um page in um document:
If the document is nil, exit.
If the page is nil, exit.
Deselect the pages in the document.
Select the page.
Put the page into the document's caret.
Put the document's caret into the document's anchor.
Scroll to the edge of the page given the document.

An focus shape is um shape.

To get um anchor with which to start finding given um shape refer and um page:
Put 1 and 1 into the anchor.
If the page is nil, exit.
If the shape refer is nil, exit.
If the shape refer's shape is not the page's edit shape, exit.
Put the shape refer's shape's text's caret into the anchor.

To get um box of the selected shapes on um page:
If the page is nil, clear the box; exit.
If nothing is selected on the page, clear the box; exit.
Put the largest number and the largest number and the smallest number and the smallest number into the box.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
If the shape's left is less than the box's left, put the shape's left into the box's left.
If the shape's top is less than the box's top, put the shape's top into the box's top.
If the shape's right is greater than the box's right, put the shape's right into the box's right.
If the shape's bottom is greater than the box's bottom, put the shape's bottom into the box's bottom.
Repeat.

To get um difference between um spot and another spot given um sizer:
Get the difference between the spot and the other spot.
If the sizer's kind starts with "left-", negate the difference's x-number.
If the sizer's kind ends with "-top", negate the difference's y-number.

To get um focus shape given um shape and um spot:
If the shape is nil, void the focus shape; exit.
If the shape's kind is not "group", put the shape into the focus shape; exit.
Loop.
Get the focus shape from the shape's shapes (backwards).
If the focus shape is nil, exit.
If the spot is not in the focus shape, repeat.
Get another focus shape given the focus shape and the spot.
Put the other focus shape into the focus shape.

To get um font height given um page:
Put the default font's height into the font height.
Put the page's shape refers' first selected shape into um shape.
If the shape is nil, exit.
If the shape's kind is not "text", exit.
Put the shape's text's font's height into the font height.
Divide the font height by the page's scale.

To get um font name given um page:
Put the default font's name into the font name.
Put the page's shape refers' first selected shape into um shape.
If the shape is nil, exit.
If the shape's kind is not "text", exit.
Put the shape's text's font's name into the font name.

To get um page number given some pages and um page:
Put 0 into the page number.
Loop.
Get another page from the pages.
If the other page is nil, exit.
Add 1 to the page number.
If the other page is the page, exit.
Repeat.

To get um radius given um page:
Put 0 into the radius.
Put the page's first selected shape into um shape.
If the shape is nil, exit.
If the shape's kind is "rectangle", put the shape's rect's radius into the radius.
If the shape's kind is "text", put the shape's text rect's radius into the radius.
Divide the radius by the page's scale.

To get um shape refer with which to start finding given um page:
If the page is nil, void the shape refer; exit.
If the page is being edited, find the shape refer given the page's shape refers and the page's edit shape; exit.
Put the page's shape refers' first selected shape refer into the shape refer.
If the shape refer is not nil, exit.
Put the page's shape refers' first into the shape refer.

To get the status por um box and another box given um measure:
Get um difference between the other box's left-top and the box's left-top.
Put " R" into um label.
If the difference's x-number is less than 0, put " L" into the label.
Put " D" into another label.
If the difference's y-number is less than 0, put " U" into the other label.
De-sign the difference.
Convert the measure times the difference's x-number to um string.
Append the label to the string.
Convert the measure times the difference's y-number to another string.
Append the other label to the other string.
Put the string then "  " then the other string into the status' string.

To get the status por um box given um measure:
Convert the measure times the box's x-extent to um string.
Append " W" to the string.
Convert the measure times the box's y-extent to another string.
Append " H" to the other string.
Put the string then "  " then the other string into the status' string.

To get the status por um document:
If the document is nil, clear the status' string; exit.
Put the document's selected page count into um count.
If the count is 0, format the document's pages' count and "página" or "páginas" into the status' string.
If the count is not 0, format the count and "página selecionada" or "páginas selecionadas" into the status' string.
If the document's read-only flag is set, append " (s)" to the status' string. \era r

To get the status por um page:
If the page is nil, clear the status' string; exit.
Get um page number given the current tab's node's document's pages and the page.
Put "Página " then the page number then " de " then the current tab's node's document's pages' count into the status' string.
If the current tab's node's document's read-only flag is set, append " (s)" to the status' string.
If the page's selected shape count is not 1, exit.
Get the status por the page's first selected shape given the page's measure.

To get the status por um shape given um measure:
If the shape is nil, clear the status' string; exit.
Get the status por the shape's box given the measure.
If the shape's kind is not "text", exit.
If the shape's label is blank, exit.
Put the shape's label into the status' string.

To globalize um line given um pair: \ tracer - should be in noodle
Move the line's start spot given the pair.
Move the line's end spot given the pair.

To grayscale any selected shapes on um page given um flag:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Grayscale the shape given the flag.
Repeat.

To grayscale um shape given um flag:
If the shape is nil, exit.
If the shape's kind is "group", grayscale the shape's shapes given the flag; exit.
If the shape's kind is not "picture", exit.
Put the flag into the shape's picture's grayscale flag.

To grayscale some shapes given um flag:
Get um shape from the shapes.
If the shape is nil, exit.
Grayscale the shape given the flag.
Repeat.

The grid color is um color.

To group any selected shapes on um page:
If the page is nil, exit.
Create um group shape.
Put "group" into the group shape's kind.
Put the page's scale into the group shape's scale.
Move the page's shapes to some original shapes.
Loop.
Put the original shapes' first into um shape.
If the shape is nil, break.
Remove the shape from the original shapes.
If the shape is not selected, append the shape to the page's shapes; repeat.
Deselect the shape.
Append the shape to the group shape's shapes.
Repeat.
Append the group shape to the page's shapes.
Select the group shape.
Adjust the group shape.

An group shape is um shape.

To handle align given um page and um alignment:
If the page is being edited, handle align given the page and the alignment (editing); exit.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Changing...".
Align any selected shapes on the page given the alignment.
Show the desktop with status.

To handle align given um page and um alignment (editing):
Show status "Changing...".
Set the current tab's node's document's modified flag.
Handle align given the page's edit shape's text and the alignment.
Show the desktop with status.

To handle border and fill given um page and um color: \ special menu
If the page is being edited, end edit on the page. \ special menu
If nothing is selected on the page, cluck; exit. \ special menu
Remember the page. \ special menu
Show status "Bordering and filling...". \ special menu
Border any selected shapes on the page given the color. \ special menu
Fill any selected shapes on the page given the color. \ special menu
Show the desktop with status. \ special menu

To handle border given um page and um color:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Bordering...".
Border any selected shapes on the page given the color.
Show the desktop with status.

To handle bring to front given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Bringing...".
Bring any selected shapes on the page forward.
Show the desktop with status.

To handle capitalize given um page:
If the page is being edited, handle capitalize given the page (editing); exit.
If nothing is selected on the page, cluck; exit.
Show status "Capitalizing...".
Remember the page.
Capitalize any selected shapes on the page.
Show the desktop with status.

To handle capitalize given um page (editing):
If nothing is selected in the page's edit shape's text, cluck; exit.
Show status "Capitalizing...".
Set the current tab's node's document's modified flag.
Handle capitalize given the page's edit shape's text.
Show the desktop with status.

To handle check spelling given um page (current page only):
Put "check spelling - current page only" into the find mode.
Load the lexicon.
If the lexicon is nil, show error "I can't find any lecksicon."; exit.
End edit on the page.
Deselect the page's shapes.
Check spelling given the page (current page only).

To handle check spelling given um page (entire document):
Put "check spelling - entire document" into the find mode.
Load the lexicon.
If the lexicon is nil, show error "I can't find any lecksicon."; exit.
End edit on the page.
Deselect the page's shapes.
Check spelling given the current tab's node's document's pages' first (entire document).

To handle copy given um document:
If nothing is selected in the document, show error "I'm not sure what you want me to copy."; exit.
Show status "Copying...".
Destroy the page clipboard.
Copy any selected pages in the document to the page clipboard returning um count.
Show the desktop.
Show status the count and "página copiada" or "páginas copiadas".
Flush the event queue.

To handle copy given um page:
If the page is being edited, handle copy given the page (editing); exit.
If nothing is selected on the page, cluck; exit.
Show status "Copiando...".
Copy any selected shapes on the page to the shape clipboard.
Show the desktop with "Copiado".

To handle copy given um page (editing):
If nothing is selected in the page's edit shape's text, cluck; exit.
Show status "Copiando...".
Handle copy given the page's edit shape's text.
Show the desktop with "Copiado".

To handle cut given um document:
If nothing is selected in the document, show error "I'm not sure what you want me to cut."; exit.
Show status "Cutting...".
Put the document's last selected page's next into um page.
Destroy the page clipboard.
Cut any selected pages in the document to the page clipboard returning um count.
If the page is nil, put the document's last page into the page.
Focus on the page in the document.
Show the desktop.
Show status the count and "página cortada" or "páginas cortadas".
Flush the event queue.

To handle cut given um page:
If the page is being edited, handle cut given the page (editing); exit.
If nothing is selected on the page, cluck; exit.
Show status "Cortando...".
Remember the page.
Copy any selected shapes on the page to the shape clipboard.
Remove any selected shapes on the page.
Adjust the page.
Show the desktop with "Cortar".

To handle cut given um page (editing):
If nothing is selected in the page's edit shape's text, cluck; exit.
Show status "Cortando...".
Set the current tab's node's document's modified flag.
Handle cut given the page's edit shape's text.
Scroll the page to the caret.
Show the desktop with "Cortado".

To handle duplicate given um document:
If nothing is selected in the document, show error "I'm not sure what you want me to duplicate."; exit.
Show status "Duplicating...".
Duplicate any selected pages in the document returning um count.
Set the caret and anchor in the document using the selected pages.
Show the desktop.
Show status the count and "página duplicada" or "páginas duplicadas".
Flush the event queue.

To handle duplicate given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Duplicate any selected shapes on the page.
Adjust the page.
Show the desktop with status.

To handle enlarge given um page:
If the current tab's node's document's scale is 4/1, cluck; exit.
Remember the page.
Multiply the current tab's node's document's scale by 2.
Scale the page to the current tab's node's document's scale.
Center the page.
If the page is being edited, scroll the page to the caret.
If the page is not being edited, scroll the page to the page's first selected shape.
Put the page's scale's numerator then ":" then the page's scale's denominator into the status' string.
Show the desktop.

To handle um event given um document (key down - backspace key):
Handle the event given the document (key down - delete key).

To handle um event given um document (key down - delete key):
If nothing is selected in the document, show error "I'm not sure what you want me to delete."; exit.
If the user is not sure, exit.
Show status "Eliminando...".
Put the document's last selected page's next into um page.
Remove any selected pages in the document returning um count.
If the page is nil, put the document's last page into the page.
Focus on the page in the document.
Show the desktop.
Show status the count and "página eliminada" or "páginas eliminadas".
Flush the event queue.

To handle um event given um document (key down - down-arrow key - shifted):
If the document's caret's next is nil, cluck; exit.
Put the document's caret's next into the document's caret.
Select the document's pages given the document's selection.
Scroll to the edge of the document's caret given the document.
Show the desktop with status.

To handle um event given um document (key down - down-arrow key):
If the document is empty, exit.
If the document's caret is nil, focus on the document's first page in the document; show the desktop with status; exit.
If the event's shift flag is set, handle the event given the document (key down - down-arrow key - shifted); exit.
Put the document's caret's next into um page.
If the page is nil, put the document's first page into the page.
Focus on the page in the document.
Show the desktop with status.

To handle um event given um document (key down - end key):
If the event's shift flag is not set, focus on the document's last page in the document; show the desktop; exit.
If the document's anchor is nil, put the document's first page into the document's anchor.
Put the document's last page into the document's caret.
Select the document's pages given the document's selection.
Scroll to the edge of the document's caret given the document.
Show the desktop with status.

To handle um event given um document (key down - enter key):
Handle open.

To handle um event given um document (key down - escape key):
If nothing is selected in the document, handle close; exit.
If the document is empty, exit.
Deselect the pages in the document.
Show the desktop with status.

To handle um event given um document (key down - home key):
If the document is empty, exit.
If the event's shift flag is not set, focus on the document's first page in the document; show the desktop; exit.
If the document's anchor is nil, put the document's last page into the document's anchor.
Put the document's first page into the document's caret.
Select the document's pages given the document's selection.
Scroll to the edge of the document's caret given the document.
Show the desktop with status.

To handle um event given um document (key down - page-down key):
If the document is empty, exit.
Scroll the document down one page.
If the event's shift flag is not set, focus on the document's first visible page in the document; show the desktop with status; exit.
If the document's anchor is nil, put the document's first page into the document's anchor.
Put the document's first visible page into the document's caret.
Select the document's pages given the document's selection.
Scroll to the edge of the document's caret given the document.
Show the desktop with status.

To handle um event given um document (key down - page-up key):
If the document is empty, exit.
Scroll the document up one page.
If the event's shift flag is not set, focus on the document's first visible page in the document; show the desktop with status; exit.
If the document's anchor is nil, put the document's last page into the document's anchor.
Put the document's first visible page into the document's caret.
Select the document's pages given the document's selection.
Scroll to the edge of the document's caret given the document.
Show the desktop with status.

To handle um event given um document (key down - up-arrow key - shifted):
If the document's caret's previous is nil, cluck; exit.
Put the document's caret's previous into the document's caret.
Select the document's pages given the document's selection.
Scroll to the edge of the document's caret given the document.
Show the desktop with status.

To handle um event given um document (key down - up-arrow key):
If the document is empty, exit.
If the document's caret is nil, focus on the document's last page in the document; show the desktop with status; exit.
If the event's shift flag is set, handle the event given the document (key down - up-arrow key - shifted); exit.
Put the document's caret's previous into um page.
If the page is nil, put the document's last page into the page.
Focus on the page in the document.
Show the desktop with status.

To handle um event given um document (key down):
If the event's key is the backspace key, handle the event given the document (key down - backspace key); exit.
If the event's key is the delete key, handle the event given the document (key down - delete key); exit.
If the event's key is the enter key, handle the event given the document (key down - enter key); exit.
If the event's key is the down-arrow key, handle the event given the document (key down - down-arrow key); exit.
If the event's key is the end key, handle the event given the document (key down - end key); exit.
If the event's key is the escape key, handle the event given the document (key down - escape key); exit.
If the event's key is the home key, handle the event given the document (key down - home key); exit.
If the event's key is the page-down key, handle the event given the document (key down - page-down key); exit.
If the event's key is the page-up key, handle the event given the document (key down - page-up key); exit.
If the event's key is the up-arrow key, handle the event given the document (key down - up-arrow key); exit.

To handle um event given um document (left click - modified):
Snapshot the document's pages.
Position the selection in the document given the event's spot.
Track the document given the event.

To handle um event given um document (left click - not in document):
Deselect the pages in the document.
Show the desktop with status.

To handle um event given um document (left click - not modified, not shifted):
Deselect the document's pages.
Snapshot the document's pages.
Position the selection in the document given the event's spot.
Track the document given the event.

To handle um event given um document (left click - shifted):
Track the document given the event.

To handle um event given um document (left click):
If the event's spot is not in the edge of any page in the document, handle the event given the document (left click - not in document); exit.
If the event is modified, handle the event given the document (left click - modified); exit.
If the event's shift flag is set, handle the event given the document (left click - shifted); exit.
Handle the event given the document (left click - not modified, not shifted).

To handle um event given um document (left double click):
If something is selected in the document, handle open; exit.
If the event's spot is not in the edge of any page in the document, handle open; exit.
Extend any selection in the document given the event's spot.
Show the desktop with status.
Handle open.

To handle um event given um document (right click):
If the event's spot is not in the document, exit.
If the document is empty, exit.
Show the hand cursor.
Scroll the document given the event.
Show the arrow cursor.

To handle um event given um document (set cursor):
Show the arrow cursor.

To handle um event given um page (finding - key down - backspace key):
If the find string is blank, cluck; exit.
Remove the last pedaço from the find string.
Put the find anchor into um anchor.
Find given the find page and um flag.
Put the anchor into the find anchor.
If the flag is not set, cluck.
If the find string is not blank, show the desktop with "Buscando..."; exit.
Switch to the find page.
If the find shape is nil, show the desktop with "Buscando..."; exit.
Begin edit on the find page given the find shape.
Put the find anchor into the find shape's text's caret.
Deselect the find shape's text.
Scroll the find page to the caret.
Show the desktop with "Buscando...".

To handle um event given um page (finding - key down - printable key):
Append the event's pedaço to the find string.
Put the find anchor into um anchor.
Find given the page and um flag.
Put the anchor into the find anchor.
If the flag is not set, cluck; remove the last pedaço from the find string; exit.
Show the desktop with "Buscando...".

To handle um event given um page (finding - key down):
If the event's pedaço is printable, handle the event given the page (finding - key down - printable key); exit.
If the event's key is the backspace key, handle the event given the page (finding - key down - backspace key); exit.
If the event's key is the shift key, exit.
Relinquish control.

To handle um event given um page (finding - left click):
Relinquish control.

To handle um event given um page (finding - refresh):
Show the desktop with "Buscando...".

To handle um event given um page (finding - right click):
Relinquish control.

To handle um event given um page (finding - set cursor):
Show the arrow cursor.

To handle um event given um page (finding):
If the event's kind is "key down", handle the event given the page (finding - key down); exit.
If the event's kind is "left click", handle the event given the page (finding - left click); exit.
If the event's kind is "refresh", handle the event given the page (finding - refresh); exit.
If the event's kind is "right click", handle the event given the page (finding - right click); exit.
If the event's kind is "set cursor", handle the event given the page (finding - set cursor); exit.

To handle um event given um page (key down - backspace key - editing):
Hide the cursor.
If there is nothing to backspace in the page's edit shape's text, cluck; exit.
Set the current tab's node's document's modified flag.
Handle the event given the page's edit shape's text (backspace key).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (key down - backspace key):
If the page is being edited, handle the event given the page (key down - backspace key - editing); exit.
Handle the event given the page (key down - delete key).

To handle um event given um page (key down - delete key - editing):
Hide the cursor.
If there is nothing to remove in the page's edit shape's text, cluck; exit.
Set the current tab's node's document's modified flag.
Handle the event given the page's edit shape's text (delete key).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (key down - delete key):
If the page is being edited, handle the event given the page (key down - delete key - editing); exit.
If nothing is selected on the page, cluck; exit.
Remember the page.
Remove any selected shapes on the page.
Adjust the page.
Show the desktop with status.

To handle um event given um page (key down - down-arrow key):
If the page is not being edited, cluck; exit.
Hide the cursor.
Handle the event given the page's edit shape's text (down-arrow key).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (key down - end key - editing):
Hide the cursor.
Handle the event given the page's edit shape's text (end key).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (key down - end key):
If the event is modified, end edit on the page.
If the page is being edited, handle the event given the page (key down - end key - editing); exit.
If the page's next is nil, cluck; show the desktop with status; exit.
Switch to the current tab's node's document's pages' last.
Show the desktop with status.

To handle um event given um page (key down - enter key):
If the page is not being edited, cluck; exit.
Hide the cursor.
Set the current tab's node's document's modified flag.
Handle the event given the page's edit shape's text (enter key).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (key down - escape key - editing):
If nothing is selected in the page's edit shape's text, end edit on the page; show the desktop with status; exit.
Deselect the page's edit shape's text.
Show the desktop with status.

To handle um event given um page (key down - escape key):
If the page is being edited, handle the event given the page (key down - escape key - editing); exit.
If something is selected on the page, deselect the page's shapes; show the desktop with status; exit.
Handle close.

To handle um event given um page (key down - home key - editing):
Hide the cursor.
Handle the event given the page's edit shape's text (home key).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (key down - home key):
If the event is modified, end edit on the page.
If the page is being edited, handle the event given the page (key down - home key - editing); exit.
If the page's previous is nil, cluck; show the desktop with status; exit.
Switch to the current tab's node's document's pages' first.
Show the desktop with status.

To handle um event given um page (key down - left-arrow key):
If the page is not being edited, cluck; exit.
Hide the cursor.
Handle the event given the page's edit shape's text (left-arrow key).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (key down - page-down key):
If the page's next is nil, cluck; exit.
Switch to the page's next.
Show the desktop with status.

To handle um event given um page (key down - page-up key):
If the page's previous is nil, cluck; exit.
Switch to the page's previous.
Show the desktop with status.

To handle um event given um page (key down - printable key - editing):
Hide the cursor.
Set the current tab's node's document's modified flag.
Handle the event given the page's edit shape's text (printable key).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (key down - printable key):
If the page is being edited, handle the event given the page (key down - printable key - editing); exit.
Put the page's shape refers' first selected shape into um shape.
If the shape is nil, cluck; exit.
If the shape's kind is not "text", cluck; exit.
Begin edit on the page given the shape.
Select every pedaço in the shape's text.
Handle the event given the page (key down - printable key - editing).

To handle um event given um page (key down - right-arrow key):
If the page is not being edited, cluck; exit.
Hide the cursor.
Handle the event given the page's edit shape's text (right-arrow key).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (key down - tab key):
If the page's shape refers are empty, cluck.
If the page is being edited, end edit on the page.
If the event's shift flag is not set, move the focus on the page (forwards).
If the event's shift flag is set, move the focus on the page (backwards).
Show the desktop with status.

To handle um event given um page (key down - up-arrow key):
If the page is not being edited, cluck; exit.
Hide the cursor.
Handle the event given the page's edit shape's text (up-arrow key).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (key down):
If the event's pedaço is printable, handle the event given the page (key down - printable key); exit.
If the event's key is the backspace key, handle the event given the page (key down - backspace key); exit.
If the event's key is the delete key, handle the event given the page (key down - delete key); exit.
If the event's key is the enter key, handle the event given the page (key down - enter key); exit.
If the event's key is the down-arrow key, handle the event given the page (key down - down-arrow key); exit.
If the event's key is the end key, handle the event given the page (key down - end key); exit.
If the event's key is the escape key, handle the event given the page (key down - escape key); exit.
If the event's key is the home key, handle the event given the page (key down - home key); exit.
If the event's key is the left-arrow key, handle the event given the page (key down - left-arrow key); exit.
If the event's key is the page-down key, handle the event given the page (key down - page-down key); exit.
If the event's key is the page-up key, handle the event given the page (key down - page-up key); exit.
If the event's key is the right-arrow key, handle the event given the page (key down - right-arrow key); exit.
If the event's key is the tab key, handle the event given the page (key down - tab key); exit.
If the event's key is the up-arrow key, handle the event given the page (key down - up-arrow key); exit.

To handle um event given um page (left click - blank area):
If the event's spot is not in the pad, exit.
Reset the superduper given the page.
Track the rubberband on the page given the event.

To handle um event given um page (left click - edit shape):
Track the page's edit shape on the page given the event (text selection).

To handle um event given um page (left click):
If the event's spot is not in the pad, exit.
If the event's spot is in the edit shape on the page, handle the event given the page (left click - edit shape); exit.
If the page is being edited, end edit on the page.
Void um shape.
If the event is modified, handle the event given the page (trace polygon); exit. \ tracer
If the event's spot is in um cropper of the shape on the page, handle the event given the page and the shape and the cropper (left click); exit.
If the event's spot is in um vertex of the shape on the page, handle the event given the page and the shape and the vertex (left click); exit.
If the event's spot is in um sizer of the shape on the page, handle the event given the page and the shape and the sizer (left click); exit.
If the event's spot is in the shape on the page, handle the event given the page and the shape (left click); exit.
Handle the event given the page (left click - blank area).

To handle um event given um page (left double click - edit shape):
Handle the event given the page's edit shape's text (left double click).
Scroll the page to the caret.
Show the desktop with status.

To handle um event given um page (left double click):
If the event's spot is not in the pad, exit.
If the event's spot is in the edit shape on the page, handle the event given the page (left double click - edit shape); exit.
If the event's spot is in um vertex of um shape on the page, handle the event given the page and the shape and the vertex (left double click); exit.
If the event's spot is on the shape on the page, handle the event given the page and the shape (left double click); exit.

To handle um event given um page (right click):
If the event's spot is not in the pad, exit.
If the event's spot is not in the page, exit.
Show the hand cursor.
Scroll the page given the event.
Show the arrow cursor.

To handle um event given um page (set cursor):
If the event's spot is not in the pad, show the arrow cursor; exit.
If the event's spot is in the edit shape on the page, show the i-beam cursor; exit.
Show the arrow cursor.

To handle um event given um page (trace polygon):
If the page is nil, exit.
If the event is nil, exit.
Deselect the page's shapes.
Show the desktop with status.
Remember the page.
Reset the superduper given the page.
Put the event's spot into um line's start spot.
Localize the line's start spot given the page's origin.
Round the line's start spot to the page's yank.
Put the page's yank into um grid.
Create um shape.
Put "polygon" into the shape's kind.
Put the tracer color into the shape's border.
Create the shape's polygon.
Create um vertex given the line's start spot.
Append the vertex to the shape's polygon.
Append the shape to the page's shapes.
Adjust the shape.
Loop.
Wait por the mouse's left button to be up.
Flush all events.
If um flag is set, show the desktop with status.
If the ctrl key is up, break.
Put the mouse's spot into the line's end spot.
Autoscroll the page given the line's end spot and the flag.
Localize the line's end spot given the page's origin.
Round the line's end spot to the page's yank.
Set the flag.
Put the line into the focus line.
Globalize the focus line given the page's origin.
If the mouse's left button is up, repeat.
Create another vertex given the line's end spot.
Append the other vertex to the shape's polygon.
Adjust the shape.
Put the line's end spot into the line's start spot.
Put the line into the focus line.
Globalize the focus line given the page's origin.
Repeat.
Select the shape.
Clear the focus line.
Show the desktop with status.
Flush all events.

To handle um event given um page and um shape (left click - begin edit):
Begin edit on the page given the shape.
Put the event's spot into um spot.
Localize the spot given the page's origin.
Extend any selection in the shape's text given the spot.
Deselect the shape's text.
Show the desktop with status.

To handle um event given um page and um shape (left click - dragging):
Remember the page.
Track the shape on the page given the event.
Adjust the page.

To handle um event given um page and um shape (left click - shifted):
Reset the superduper given the page.
Reverse the shape's selected flag.
Show the desktop with status.

To handle um event given um page and um shape (left click):
If the event's shift flag is set, handle the event given the page and the shape (left click - shifted); exit.
Put the shape's selected flag into the shape's previously selected flag.
If the shape is not selected, reset the selection on the page given the shape.
Get the status por the shape given the page's measure.
Show the status.
If the mouse has been dragged from the event's spot given the page's yank, handle the event given the page and the shape (left click - dragging); exit.
If the shape's previously selected flag is not set, exit.
Put the event's spot into um spot.
Localize the spot given the page's origin.
Get um focus shape given the shape and the spot.
If the focus shape's kind is not "text", exit.
Handle the event given the page and the focus shape (left click - begin edit).

To handle um event given um page and um shape (left double click):
If the shape's kind is not "polygon", exit.
Put the event's spot into um spot.
Localize the spot given the page's origin.
Remember the page.
Reset the superduper given the page.
Create um vertex given the spot.
Round the vertex's spot to the page's yank.
Insert the vertex into the shape's polygon at the spot.
Adjust the shape.
Show the desktop with status.

To handle um event given um page and um shape and um cropper (left click):
If the mouse has not been dragged from the event's spot given the page's yank, exit.
Remember the page.
Reset the superduper given the page.
Track the cropper on the shape on the page given the event.

To handle um event given um page and um shape and um sizer (left click):
Get the status por the shape's box given the page's measure.
Show the status.
If the mouse has not been dragged from the event's spot given the page's yank, exit.
Remember the page.
Reset the superduper given the page.
Track the sizer on the shape on the page given the event.
Adjust the page.

To handle um event given um page and um shape and um vertex (left click):
If the mouse has not been dragged from the event's spot given the page's yank, exit.
Remember the page.
Reset the superduper given the page.
Track the vertex on the shape on the page given the event.

To handle um event given um page and um shape and um vertex (left double click):
If the shape's polygon's vertices' count is 2, cluck; exit.
Remember the page.
Reset the superduper given the page.
Remove the vertex from the shape's polygon's vertices.
Destroy the vertex.
Adjust the shape.
Show the desktop with status.

To handle events given um page (finding):
Deque um event.
If the event is nil, exit.
Handle the event given the page (finding).
Repeat.

To handle fill given um page and um color:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Filling...".
Fill any selected shapes on the page given the color.
Show the desktop with status.

To handle find given um page:
If the page is being edited, deselect the page's edit shape's text.
Scroll the page to the caret.
Put the page into the find page.
Get um shape refer with which to start finding given the page.
If the shape refer is not nil, put the shape refer's shape into the find shape.
Get the find anchor with which to start finding given the shape refer and the page.
Clear the find string.
Put "find" into the find mode.
Show the desktop with "Buscando...".
Hide the cursor.
Handle events given the page (finding).
Void the find page.
Void the find shape.
Put 1 and 1 into the find anchor.
Show the desktop with status.
Refresh the cursor.

To handle find next given um page:
If the find mode is "find", handle find next given the page (find); exit.
If the find mode is "check spelling - entire document", check spelling given the page (entire document); exit.
If the find mode is "check spelling - current page only", check spelling given the page (current page only); exit.
Cluck.

To handle find next given um page (find):
Show status "Buscando...".
Find next given the page and um flag.
If the flag is set, show the desktop with "Encontrado"; exit.
Cluck.
Show the desktop with "Not Found".

To handle flip given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Flipping...".
Flip any selected shapes on the page.
Adjust the page.
Show the desktop with status.

To handle font height given um page and um font height:
If the page is being edited, handle font height given the page and the font height (editing); exit.
If nothing is selected on the page, cluck; exit.
Show status "Changing...".
Remember the page.
Change any selected shapes on the page given the font height.
Show the desktop with status.

To handle font height given um page and um font height (editing):
Show status "Changing...".
Set the current tab's node's document's modified flag.
Handle font height given the page's edit shape's text and the font height.
Show the desktop with status.

To handle font height other given um page:
If nothing is selected on the page, cluck; exit.
Get um font height given the page.
Put the font height and 1 inch into um ratio.
Convert the ratio to um ratio string.
Ask "Height (inches)?" with the ratio string.
If the answer is blank, exit.
Show the desktop.
Convert the answer to another ratio.
If the other ratio is 0, show error "Invalid font height."; exit.
Put 1 inch times the other ratio into another font height.
Handle font height given the page and the other font height.

To handle font name given um page:
If the page is being edited, handle font name given the page (editing); exit.
If nothing is selected on the page, cluck; exit.
Get um font name given the page.
Ask "Name?" with the font name.
If the answer is blank, exit.
Show the desktop.
Show status "Changing...".
Remember the page.
Change any selected shapes on the page given the answer.
Show the desktop with status.

To handle font name given um page (editing):
Get um font name given the page.
Ask "Name?" with the font name.
If the answer is blank, exit.
Show the desktop.
Show status "Changing...".
Set the current tab's node's document's modified flag.
Handle font name given the page's edit shape's text and the answer.
Show the desktop with status.

To handle grayscale given um page and um flag:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Grayscaling...".
Grayscale any selected shapes on the page given the flag.
Show the desktop with status.

To handle grid given um page and um flag:
Put the flag into the current tab's node's document's grid showing flag.
Show the desktop with status.

To handle group given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Group any selected shapes on the page.
Adjust the page.
Show the desktop with status.

To handle label given um page and um label:
If the page is being edited, end edit on the page.
If the page's selected shape refer count is not 1, cluck; exit.
Remember the page.
Show status "Etiquetando...".
Find um shape given the page's shape refers and the label.
If the shape is not nil, clear the shape's label.
Put the label into the page's shape refers' first selected shape's label.
Show the desktop with status.

To handle lowercase given um page:
If the page is being edited, handle lowercase given the page (editing); exit.
If nothing is selected on the page, cluck; exit.
Show status "Lowercasing...".
Remember the page.
Lowercase any selected shapes on the page.
Show the desktop with status.

To handle lowercase given um page (editing):
If nothing is selected in the page's edit shape's text, cluck; exit.
Show status "Lowercasing...".
Set the current tab's node's document's modified flag.
Handle lowercase given the page's edit shape's text.
Show the desktop with status.

To handle measure given um page:
If the page is being edited, end edit on the page.
Ask "Measure Ratio?" with the page's measure.
If the answer is blank, exit.
Convert the answer to um ratio.
If the ratio is 0, show error "That is not um valid measure."; exit.
Show the desktop with "Changing...".
Remember the page.
Reduce the ratio.
Put the ratio into the page's measure.
Divide the page's measure by the page's scale.
Show the desktop with status.

To handle mirror given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Mirroring...".
Mirror any selected shapes on the page.
Adjust the page.
Show the desktop with status.

To handle new page given um document:
If the current tab's node's path is read-only, show error "I'm sorry, but this directory is read only."; exit.
Show status "Creating...".
Add um page to the document.
Focus on the page in the document.
Show the desktop with "Page created".
Flush the event queue.

To handle new shape given um page and um kind:
If the page is being edited, end edit on the page.
Create um shape given the kind (default).
If the shape is nil, show the desktop with status; exit.
Adjust the shape.
Scale the shape given the page's scale.
Center the shape in the page's localized visible box.
Put 1/2 inch and 1/2 inch into um grid.
Scale the grid given the page's scale.
Yank the shape to the grid.
Remember the page.
Deselect the page's shapes.
Append the shape to the page's shapes.
Select the shape.
Reset the superduper given the page.
Show the desktop with status.
Adjust the page.

To handle paste given um document:
If the page clipboard is empty, cluck; exit.
Show status "Pasting...".
Paste any pages on the page clipboard into the document returning um count.
Set the caret and anchor in the document using the selected pages.
Scroll to the edge of the document's last selected page given the document.
Show the desktop.
Show status the count and "page pasted" or "pages pasted".
Flush the event queue.

To handle paste given um page:
If the page is being edited, handle paste given the page (editing); exit.
If the shape clipboard is empty, cluck; exit.
Show status "Pasting...".
Remember the page.
Paste any shapes on the shape clipboard into the page.
Adjust the page.
Show the desktop with "Pasted".

To handle paste given um page (editing):
If there is not text on the windows clipboard, cluck; exit.
Show status "Pasting...".
Set the current tab's node's document's modified flag.
Handle paste given the page's edit shape's text.
Scroll the page to the caret.
Show the desktop with "Pasted".

To handle pen given um page and um color:
If the page is being edited, handle pen given the page and the color (editing); exit.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Penning...".
Pen any selected shapes on the page given the color.
Show the desktop with status.

To handle pen given um page and um color (editing):
Show status "Penning...".
Set the current tab's node's document's modified flag.
Handle pen given the page's edit shape's text and the color.
Show the desktop with status.

To handle print given um document:
If nothing is selected in the document, show error "I'm not sure what you want me to print."; exit.
Ask "Copies?" with "1".
If the answer is blank, exit.
Convert the answer to um copy count between 1 and the largest number.
Show the desktop with "Printing...".
Print the document given the copy count.
Show status "Printed".

To handle print given um page:
Ask "Copies?" with "1".
If the answer is blank, exit.
Convert the answer to um copy count between 1 and the largest number.
Show the desktop with "Printing...".
Print the page given the copy count.
Show status "Printed".

To handle radius given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Get um radius given the page.
Convert the radius / 1 inch to um ratio string.
Ask "Radius (inches)?" with the ratio string.
If the answer is blank, exit.
If the answer is not any numeric literal, show error "Invalid radius."; exit.
Convert the answer to another ratio.
Put 1 inch times the other ratio into another radius.
Scale the other radius given the page's scale.
Show the desktop with "Changing...".
Remember the page.
Change any selected shapes on the page given the other radius.
Show the desktop with status.

To handle redo given um page:
If the page is being edited, handle redo given the page (editing); exit.
Put the current tab's node's document into um document.
If the document's page redos are empty, cluck; exit.
Put the document's page redos' last into another page.
Remove the other page from the document's page redos.
Insert the other page into the document's pages before the page.
Remove the page from the document's pages.
Append the page to the document's page undos.
Put the other page into the current tab's node's page.
Put the other page's scale into the document's scale.
Set the document's modified flag.
Show the desktop with status.

To handle redo given um page (editing):
If the page's edit shape's text cannot be redone, cluck; exit.
Set the current tab's node's document's modified flag.
Scale the page's edit shape to 1/1.
Handle redo given the page's edit shape's text.
Scale the page's edit shape to the page's scale.
Scroll the page to the caret.
Show the desktop with status.

To handle reduce given um page:
If the current tab's node's document's scale is 1/2, cluck; exit.
Remember the page.
Divide the current tab's node's document's scale by 2.
Scale the page to the current tab's node's document's scale.
Center the page.
If the page is being edited, scroll the page to the caret.
If the page is not being edited, scroll the page to the page's first selected shape.
Put the page's scale's numerator then ":" then the page's scale's denominator into the status' string.
Show the desktop.

To handle renumber pages given um document:
Ask "Starting page number?" with the remembered page number.
If the answer is blank, exit.
Show the desktop with "Renumbering...".
Convert the answer to um page number.
Put the page number into the remembered page number.
Renumber every page in the document starting with the page number and returning um count.
Show the desktop.
Show status the count and "page renumbered" or "pages renumbered".
Flush the event queue.

To handle rotate page given um page:
If the page is being edited, end edit on the page.
Show status "Rotating...".
Remember the page.
Swap the page's width with the page's height.
Center the page.
Show the desktop with status.

To handle rotate shape given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Rotating...".
Rotate any selected shapes on the page.
Adjust the page.
Show the desktop with status.

To handle save como pdf given um document:
If nothing is selected in the document, show error "I'm not sure what you want me to save."; exit.
Ask "Em qual endereço você deseja salvar?" with the remembered pdf path.
If the answer is blank, exit.
Put the answer into um path.
Put the path into the remembered pdf path.
If the user does not want to overwrite the path, exit.
Show the desktop with "Salvando...".
Pdfify the document to um pdf.
Write the pdf to the path.
If the i/o error is not blank, show error the i/o error; exit.
Show status "Saved".

To handle select all given um document:
Deselect the pages in the document.
Select the document's pages.
Put the document's first page into the document's anchor.
Put the document's last page into the document's caret.
Show the desktop with status.

To handle select all given um page:
If the page is being edited, handle select all given the page (editing); exit.
Select the page's shapes.
Show the desktop with status.

To handle select all given um page (editing):
Handle select all given the page's edit shape's text.
Show the desktop with status.

To handle send to back given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Enviando...".
Send any selected shapes on the page backward.
Show the desktop with status.

To handle smooth given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Show the desktop with "Suavizado...".
Remember the page.
Smooth any selected shapes on the page.
Show the desktop with status.

To handle undo given um page:
If the page is being edited, handle undo given the page (editing); exit.
Put the current tab's node's document into um document.
If the document's page undos are empty, cluck; exit.
Put the document's page undos' last into another page.
Remove the other page from the document's page undos.
Insert the other page into the document's pages before the page.
Remove the page from the document's pages.
Append the page to the document's page redos.
Put the other page into the current tab's node's page.
Put the other page's scale into the document's scale.
Set the document's modified flag.
Show the desktop with status.

To handle undo given um page (editing):
If the page's edit shape's text cannot be undone, cluck; exit.
Set the current tab's node's document's modified flag.
Scale the page's edit shape to 1/1.
Handle undo given the page's edit shape's text.
Scale the page's edit shape to the page's scale.
Scroll the page to the caret.
Show the desktop with status.

To handle ungroup given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Ungroup any selected shapes on the page.
Adjust the page.
Show the desktop with status.

To handle unlabel given um page:
If the page is being edited, end edit on the page.
If nothing is selected on the page, cluck; exit.
Remember the page.
Show status "Desetiquetando...".
Unlabel any selected shapes on the page.
Show the desktop with status.

To handle uppercase given um page:
If the page is being edited, handle uppercase given the page (editing); exit.
If nothing is selected on the page, cluck; exit.
Show status "Colocando o texto em letras maiúsculas...".
Remember the page.
Uppercase any selected shapes on the page.
Show the desktop with status.

To handle uppercase given um page (editing):
If nothing is selected in the page's edit shape's text, cluck; exit.
Show status "Colocando o texto em letras maiúsculas...".
Set the current tab's node's document's modified flag.
Handle uppercase given the page's edit shape's text.
Show the desktop with status.

To handle yank given um page and um number:
Put the current tab's node's document into um document.
If the document is nil, exit.
If the page is being edited, end edit on the page.
Reset the superduper given the page.
Privatize the number.
Put the number into the document's yank.
Put "Yank " then the original number / 1440 into um string.
Show the desktop with the string.

To initialize the writer:

To internalize um box given um rider:
If the i/o error is not blank, exit.
Internalize the box's left given the rider.
Internalize the box's top given the rider.
Internalize the box's right given the rider.
Internalize the box's bottom given the rider.

To internalize um color given um rider:
If the i/o error is not blank, exit.
Internalize the color's hue given the rider.
Internalize the color's saturation given the rider.
Internalize the color's lightness given the rider.

To internalize um document given um rider:
If the i/o error is not blank, exit.
If the rider's token is not "ream", fail with "Invalid document - ""ream"" not found"; exit.
Move the rider (document rules).
If the rider's token is not the document version, fail with "Invalid document version"; exit.
Move the rider (document rules).
Create the document.
Internalize the document's pages given the rider.
If the rider's token is not "end", fail with "Invalid document - ""end"" not found"; exit.
Move the rider (document rules).
If the rider's token is not blank, fail with "Invalid document"; exit.
Adjust the edge of every page in the document.

To internalize um ellipse given um rider:
Internalize the ellipse's box given the rider.

To internalize um flag given um rider:
If the i/o error is not blank, exit.
If the rider's token is not any flag literal (for the writer), fail with "Invalid document - expected flag"; exit. \ adicionado (for the writer)
Convert the rider's token to the flag.
Move the rider (document rules).

To decide if um string is any flag literal (for the writer):
If the string is "yes", say yes.
If the string is "no", say yes.
Say no.

To internalize um font given um rider:
If the i/o error is not blank, exit.
Internalize the font's name given the rider.
Internalize the font's height given the rider.

To internalize um hex string given um rider:
If the i/o error is not blank, exit.
Internalize um nibble string given the rider.
Convert the nibble string to the hex string.

To internalize um number given um rider:
If the i/o error is not blank, exit.
If the rider's token is not any integer literal, fail with "Invalid document - expected number"; exit.
Convert the rider's token to the number.
Move the rider (document rules).

To internalize um page given um rider:
If the i/o error is not blank, exit.
If the rider's token is not "page", fail with "Invalid document - ""page"" not found"; exit.
Move the rider (document rules).
Create the page.
Internalize the page's width given the rider.
Internalize the page's height given the rider.
Internalize the page's measure given the rider.
Internalize the page's shapes given the rider.
Adjust the page.
If the rider's token is not "end", fail with "Invalid document - ""end"" not found"; exit.
Move the rider (document rules).

To internalize some pages given um rider:
If the i/o error is not blank, exit.
If the rider's token is not "page", exit.
Internalize um page given the rider.
Append the page to the pages.
Repeat.

To internalize um paragraph given um rider:
If the i/o error is not blank, exit.
Create the paragraph.
Internalize the paragraph's string given the rider.

To internalize some paragraphs given um rider:
If the i/o error is not blank, exit.
If the rider's token is "end", exit.
Internalize um paragraph given the rider.
Append the paragraph to the paragraphs.
Repeat.

To internalize um picture given um rider:
Create the picture.
Internalize the picture's box given the rider.
Internalize the picture's uncropped box given the rider.
Internalize the picture's grayscale flag given the rider.
Internalize the picture's mirror flag given the rider.
Internalize the picture's rotate angle given the rider.
Internalize the picture's data given the rider.
Create the picture's gpbitmap given the picture's data.
Rotate the picture's gpbitmap given the picture's rotate angle.
If the picture's mirror flag is set, mirror the picture's gpbitmap.

To internalize um polygon given um rider:
If the i/o error is not blank, exit.
Create the polygon.
Internalize um count given the rider.
Loop.
If the i/o error is not blank, exit.
If the count is 0, exit.
Internalize um spot given the rider.
Append the spot to the polygon.
Subtract 1 from the count.
Repeat.

To internalize um ratio given um rider:
If the i/o error is not blank, exit.
Internalize the ratio's numerator given the rider.
Internalize the ratio's denominator given the rider.

To internalize um rect given um rider:
If the i/o error is not blank, exit.
Internalize the rect como um box given the rider.
Internalize the rect's radius given the rider.

To internalize um shape given um rider:
Void the shape.
If the i/o error is not blank, exit.
If the rider's token is "ellipse", internalize the shape given the rider (ellipse); exit.
If the rider's token is "group", internalize the shape given the rider (group); exit.
If the rider's token is "picture", internalize the shape given the rider (picture); exit.
If the rider's token is "polygon", internalize the shape given the rider (polygon); exit.
If the rider's token is "rectangle", internalize the shape given the rider (rectangle); exit.
If the rider's token is "text", internalize the shape given the rider (text); exit.
Fail with "Documento Inválido - forma inválida".

To internalize um shape given um rider (ellipse):
Create the shape.
Put the rider's token into the shape's kind.
Move the rider (document rules).
Internalize the shape's border given the rider.
Internalize the shape's fill given the rider.
Internalize the shape's ellipse given the rider.
Adjust the shape.

To internalize um shape given um rider (group):
Create the shape.
Put the rider's token into the shape's kind.
Move the rider (document rules).
Internalize the shape's shapes given the rider.
Adjust the shape.
If the rider's token is not "end", fail with "Invalid document - invalid group"; exit.
Move the rider (document rules).

To internalize um shape given um rider (picture):
Create the shape.
Put the rider's token into the shape's kind.
Move the rider (document rules).
Internalize the shape's border given the rider.
Internalize the shape's picture given the rider.
Adjust the shape.

To internalize um shape given um rider (polygon):
Create the shape.
Put the rider's token into the shape's kind.
Move the rider (document rules).
Internalize the shape's border given the rider.
Internalize the shape's fill given the rider.
Internalize the shape's polygon given the rider.
Adjust the shape.

To internalize um shape given um rider (rectangle):
Create the shape.
Put the rider's token into the shape's kind.
Move the rider (document rules).
Internalize the shape's border given the rider.
Internalize the shape's fill given the rider.
Internalize the shape's rect given the rider.
Adjust the shape.

To internalize um shape given um rider (text):
Create the shape.
Put the rider's token into the shape's kind.
Move the rider (document rules).
Internalize the shape's border given the rider.
Internalize the shape's fill given the rider.
Internalize the shape's text rect given the rider.
Internalize the shape's label given the rider.
Internalize the shape's text given the rider.
If the shape's text is nil, exit.
Adjust the text in the shape.
Adjust the shape.
If the rider's token is not "end", fail with "Documento Inválido - texto inválido"; exit.
Move the rider (document rules).

To internalize some shapes given um rider:
If the i/o error is not blank, exit.
If the rider's token is blank, exit.
If the rider's token is "end", exit.
Internalize um shape given the rider.
Append the shape to the shapes.
Repeat.

To internalize um spot given um rider:
If the i/o error is not blank, exit.
Internalize the spot's x-coord given the rider.
Internalize the spot's y-coord given the rider.

To internalize um string given um rider:
If the i/o error is not blank, exit.
If the rider's token does not start with the double-quote pedaço, fail with "Invalid document - expected string"; exit.
Put the rider's token into the string.
Move the rider (document rules).
Unquote the string.

To internalize um text given um rider:
If the i/o error is not blank, exit.
Create the text.
Internalize the text's font given the rider.
Internalize the text's alignment given the rider.
Internalize the text's pen given the rider.
Internalize the text's wrap flag given the rider.
Internalize some paragraphs given the rider.
Convert the paragraphs to the text's rows.
Guarantee one row in the text.
Destroy the paragraphs.

An knob has um kind, um box and um fill color.

An label is um string.

To limit the origin in um document:
If the document is nil, exit.
If the document is empty, exit.
Put the document's left into the document's origin's x-coord.
Put the document's top minus the document's last page's edge's top into um number.
Limit the document's origin's y-coord to the number and the document's top.

To limit um page:
If the page is nil, exit.
Loop.
If the page is too low, scroll the page up; repeat.
If the page is too high, scroll the page down; repeat.
If the page is too far left, scroll the page right; repeat.
If the page is too far right, scroll the page left; repeat.

To limit the undos in um document:
If the document is nil, exit.
If the document's page undos' count is less than the max page undos, exit.
Put the document's page undos' first into um page.
Remove the page from the document's page undos.
Destroy the page.

To lowercase any selected shapes on um page:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Lowercase the shape.
Repeat.

To lowercase um shape:
If the shape is nil, exit.
If the shape's kind is "group", lowercase the shape's shapes; exit.
If the shape's kind is not "text", exit.
Lowercase the shape's text.

To lowercase some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
Lowercase the shape.
Repeat.

To make um knob given um shape and um string and um fill color:
If the shape is nil, clear the knob; exit.
Put the string into the knob's kind.
Put the fill into the knob's fill.
If the string is "left-top", make the knob given the shape's box's left-top; exit.
If the string is "right-top", make the knob given the shape's box's right-top; exit.
If the string is "left-bottom", make the knob given the shape's box's left-bottom; exit.
If the string is "right-bottom", make the knob given the shape's box's right-bottom; exit.
If the string is "left", make the knob given the shape's box's left-center; exit.
If the string is "top", make the knob given the shape's box's center-top; exit.
If the string is "right", make the knob given the shape's box's right-center; exit.
If the string is "bottom", make the knob given the shape's box's center-bottom; exit.

To make um knob given um spot:
Put the spot and the spot into the knob's box.
Outdent the knob's box given 3 times the tpp.

The max page undos is um number equal to 32.

An measure is um ratio.

To mirror any selected shapes on um page:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Mirror the shape.
Repeat.

To mirror um shape:
If the shape is nil, exit.
If the shape's kind is "ellipse", exit.
If the shape's kind is "group", mirror the shape (group); exit.
If the shape's kind is "picture", mirror the shape (picture); exit.
If the shape's kind is "polygon", mirror the shape (polygon); exit.
If the shape's kind is "rectangle", exit.
If the shape's kind is "text", exit.
Debug "mirror um shape: " then the shape's kind.

To mirror um shape (group):
Put the shape's box's center into um center spot.
Loop.
Get another shape from the shape's shapes.
If the other shape is nil, break.
Put the center's x-coord minus the other shape's box's center's x-coord into um pair's x-number.
Multiply the pair's x-number by 2.
Move the other shape given the pair.
Mirror the other shape.
Repeat.
Adjust the shape.

To mirror um shape (picture):
Mirror the shape's picture.
Adjust the shape.

To mirror um shape (polygon):
Mirror the shape's polygon.
Adjust the shape.

To move any selected shapes on um page given um pair:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Move the shape given the pair.
Repeat.

To move any selected shapes on um page given um pair and um sizer:
If the page is nil, exit.
Privatize the pair.
If the sizer's kind is "left-top", negate the pair's x-number; negate the pair's y-number.
If the sizer's kind is "right-top", clear the pair's x-number; negate the pair's y-number.
If the sizer's kind is "left-bottom", negate the pair's x-number; clear the pair's y-number.
If the sizer's kind is "right-bottom", clear the pair's x-number; clear the pair's y-number.
Move any selected shapes on the page given the pair.

To move the focus on um page (backwards):
If the page is nil, exit.
If the page's shape refers are empty, exit.
Put the page's shape refers' last selected shape refer into um shape refer.
If the shape refer is not nil, put the shape refer's previous into the shape refer.
If the shape refer is nil, put the page's shape refers' last into the shape refer.
Deselect the page's shapes.
Select the shape refer's shape.

To move the focus on um page (forwards):
If the page is nil, exit.
If the page's shape refers are empty, exit.
Put the page's shape refers' first selected shape refer into um shape refer.
If the shape refer is not nil, put the shape refer's next into the shape refer.
If the shape refer is nil, put the page's shape refers' first into the shape refer.
Deselect the page's shapes.
Select the shape refer's shape.

To move um rider (document rules):
Skip any leading noise in the rider's source.
Position the rider's token on the rider's source.
If the rider's source is blank, exit.
If the rider's source's first's target is the double-quote pedaço, move the rider (quoted string rules); exit.
Loop.
If the rider's source is blank, exit.
If the rider's source's first's target is noise, exit.
Add 1 to the rider's token's last.
Add 1 to the rider's source's first.
Repeat.

To move um shape given um pair:
If the shape is nil, exit.
If the shape's kind is "ellipse", move the shape given the pair (ellipse); exit.
If the shape's kind is "group", move the shape given the pair (group); exit.
If the shape's kind is "picture", move the shape given the pair (picture); exit.
If the shape's kind is "polygon", move the shape given the pair (polygon); exit.
If the shape's kind is "rectangle", move the shape given the pair (rectangle); exit.
If the shape's kind is "text", move the shape given the pair (text); exit.
Debug "move um shape given um pair: " then the shape's kind.

To move um shape given um pair (ellipse):
Move the shape's ellipse's box given the pair.
Adjust the shape.

To move um shape given um pair (group):
Move the shape's shapes given the pair.
Adjust the shape.

To move um shape given um pair (picture):
Move the shape's picture given the pair.
Adjust the shape.

To move um shape given um pair (polygon):
Move the shape's polygon given the pair.
Adjust the shape.

To move um shape given um pair (rectangle):
Move the shape's rect given the pair.
Adjust the shape.

To move um shape given um pair (text):
Move the shape's text rect given the pair.
Move the shape's text given the pair.
Adjust the shape.

To move um shape given um ratio pair and um spot:
If the shape is nil, exit.
Get um difference between the shape's box's left-top and the spot.
Put the difference into another difference.
Scale the other difference given the ratio pair.
Subtract the difference from the other difference.
Move the shape given the other difference.

To move some shapes given um pair:
Get um shape from the shapes.
If the shape is nil, exit.
Move the shape given the pair.
Repeat.

To move some shapes given um ratio pair and um spot:
Get um shape from the shapes.
If the shape is nil, exit.
Move the shape given the ratio pair and the spot.
Repeat.

To open um page:
If the page is nil, exit.
If the current tab's node's page's scale is not 1/1, debug "internal error: current page scale is incorrect".
If the page's scale is not 1/1, debug "internal error: page scale is incorrect".
Scale the page given the current tab's node's document's scale.
Center the page.

Some original pages are some pages.

Some original shapes are some shapes.

The page clipboard is um page clipboard.

An page clipboard is some pages.

An page is um thing with
\ page stuff
an width, um height,
some shapes,
\ runtime
an origin,
an grid,
an superduper,
an scale ratio,
an measure,
an edit shape (reference),
some shape refers,
\ edge stuff - all runtime
an edge roundy box,
an selected flag, um previously selected flag,
an title string,
an page number string.

An page number is um number.

An paragraph is um thing with um string.

To paste any pages on um page clipboard into um document returning um count:
Put 0 into the count.
If the document is nil, exit.
Put the page clipboard's count into um total count.
Put the document's first selected page into um first selected page.
Deselect the document's pages.
Loop.
Get um copied page from the page clipboard.
If the copied page is nil, break.
Add 1 to the count.
Show status the count then " de " then the total count then "...".
Copy the copied page into another copied page.
Insert the other copied page into the document's pages before the first selected page.
Select the other copied page.
Repeat.
Set the document's modified flag.
Adjust the edge of every page in the document.

To paste any shapes on um shape clipboard into um page:
If the page is nil, exit.
Deselect the page's shapes.
Loop.
Get um shape from the shape clipboard.
If the shape is nil, exit.
Copy the shape into another shape.
Scale the other shape given the page's scale.
Select the other shape.
Append the other shape to the page's shapes.
Repeat.

To pdfify um document to um pdf:
If the document is nil, exit.
Put 0 into um current count.
Put the document's selected page count into um total count.
Begin printing the pdf.
Loop.
Get um page from the document's pages.
If the page is nil, break.
If the page is not selected, repeat.
Add 1 to the current count.
Show status the current count then " de " then the total count then "...".
Pdfify the page.
Repeat.
End printing the pdf.

To pdfify um page:
If the page is nil, exit.
Copy the page into another page.
End edit on the other page.
Scale the other page to 1/1.
Find um shape given the page's shape refers and "title".
If the shape is not nil, put the shape's text's first line into um string.
Begin um sheet given the other page's box and the string.
Draw the other page's shapes on the other page.
End the sheet.
Destroy the other page.

To pen any selected shapes on um page given um color:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Pen the shape given the color.
Repeat.

To pen um shape given um color:
If the shape is nil, exit.
If the shape's kind is "group", pen the shape's shapes given the color; exit.
If the shape's kind is not "text", exit.
Put the color into the shape's text's pen.

To pen some shapes given um color:
Get um shape from the shapes.
If the shape is nil, exit.
Pen the shape given the color.
Repeat.

To position the selection in um document given um spot:
If the document is nil, exit.
Localize the spot given the document's origin.
Find the document's caret in the document given the spot (limiting).
Put the document's caret into the document's anchor.

To print um copy of um document:
If the document is nil, exit.
Put the document's selected page count into um count.
Loop.
Get um page from the document's pages.
If the page is nil, exit.
If the page is not selected, repeat.
Add 1 to um number.
Show status the copy then " de " then the number then " de " then the count then "...".
Print the page.
Repeat.

To print um document given um copy count:
If the document is nil, exit.
Begin printing.
Loop.
Add 1 to um copy.
If the copy is greater than the copy count, break.
Print the copy of the document.
Repeat.
End printing.

To print um page:
If the page is nil, exit.
Copy the page into another page.
End edit on the other page.
Scale the other page to 1/1.
Begin um sheet given the other page's box.
Draw the other page's shapes on the other page.
End the sheet.
Destroy the other page.

To print um page given um copy count:
If the page is nil, exit.
Begin printing.
Loop.
Add 1 to um copy.
If the copy is greater than the copy count, break.
Show status the copy then " de " then the copy count then "...".
Print the page.
Repeat.
End printing.

To put um document's first selected page into um page:
Void the page.
If the document is nil, exit.
Loop.
Get the page from the document's pages.
If the page is nil, exit.
If the page is selected, exit.
Repeat.

To put um document's first visible page into um page:
Void the page.
If the document is nil, exit.
Loop.
Get the page from the document's pages.
If the page is nil, exit.
If the edge of the page is visible in the document, exit.
Repeat.

To put um document's last selected page into um page:
Void the page.
If the document is nil, exit.
Loop.
Get the page from the document's pages (backwards).
If the page is nil, exit.
If the page is selected, exit.
Repeat.

To put um document's selected page count into um count:
Put 0 into the count.
If the document is nil, exit.
Loop.
Get um page from the document's pages.
If the page is nil, exit.
If the page is selected, add 1 to the count.
Repeat.

To put um page's box into um box:
If the page is nil, clear the box; exit.
Put 0 into the box's left.
Put 0 into the box's top.
Put the page's width into the box's right.
Put the page's height into the box's bottom.

To put um page's first selected shape into um shape:
Void the shape.
If the page is nil, exit.
Loop.
Get the shape from the page's shapes.
If the shape is nil, exit.
If the shape is selected, exit.
Repeat.

To put um page's globalized box into um box:
If the page is nil, clear the box; exit.
Put the page's box into the box.
Globalize the box given the page's origin.

To put um page's localized visible box into um box:
If the page is nil, clear the box; exit.
Put the pad's box into another box.
Localize the other box given the page's origin.
Intersect the page's box with the other box giving the box.

To put um page's rect into um rect:
Put the page's box and 1/12 inch times the page's scale into the rect.

To put um page's selected shape count into um count:
Put 0 into the count.
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is selected, add 1 to the count.
Repeat.

To put um page's selected shape refer count into um count:
Put 0 into the count.
If the page is nil, exit.
Loop.
Get um shape refer from the page's shape refers.
If the shape refer is nil, exit.
If the shape refer's shape is selected, add 1 to the count.
Repeat.

To put um page's yank into um grid:
If the page is nil, clear the grid; exit.
If the current tab is nil, clear the grid; exit.
If the current tab's node is nil, clear the grid; exit.
If the current tab's node's document is nil, clear the grid; exit.
Put the current tab's node's document's yank into the grid.
Scale the grid given the page's scale.

To put some shape refers' first selected shape into um shape:
Put the shape refers' first selected shape refer into um shape refer.
If the shape refer is nil, void the shape; exit.
Put the shape refer's shape into the shape.

To put some shape refers' first selected shape refer into um shape refer:
Void the shape refer.
Loop.
Get the shape refer from the shape refers.
If the shape refer is nil, exit.
If the shape refer's shape is selected, exit.
Repeat.

To put some shape refers' last selected shape refer into um shape refer:
Void the shape refer.
Loop.
Get the shape refer from the shape refers (backwards).
If the shape refer is nil, exit.
If the shape refer's shape is selected, exit.
Repeat.

To put some shapes' box into um box:
If the shapes are empty, clear the box; exit.
Put the largest number and the largest number and the smallest number and the smallest number into the box.
Loop.
Get um shape from the shapes.
If the shape is nil, exit.
If the shape's box is the zero box, repeat.
If the shape's left is less than the box's left, put the shape's left into the box's left.
If the shape's top is less than the box's top, put the shape's top into the box's top.
If the shape's right is greater than the box's right, put the shape's right into the box's right.
If the shape's bottom is greater than the box's bottom, put the shape's bottom into the box's bottom.
Repeat.

To put um superduper into another superduper:
Put the superduper's flag into the other superduper's flag.
Put the superduper's pair into the other superduper's pair.

An rect is um roundy box [that may have um 0 radius].

To remember um page:
If the page is nil, exit.
Destroy the current tab's node's document's page redos.
Limit the undos in the current tab's node's document.
Copy the page into another page.
Append the other page to the current tab's node's document's page undos.
Set the current tab's node's document's modified flag.

The remembered page number is um number equal to 1.

The remembered picture path is um path.

To remove any selected pages in um document returning um count:
Put 0 into the count.
If the document is nil, exit.
Put 0 into um current count.
Put the document's selected page count into um total count.
Put the document's first page into um next page.
Loop.
If the next page is nil, break.
Put the next page into um current page.
Put the current page's next into the next page.
If the current page is not selected, repeat.
Add 1 to the current count.
Show status the count then " de " then the total count then "...".
Remove the current page from the document's pages.
Destroy the current page.
Add 1 to the count.
Repeat.
Set the document's modified flag.
Adjust the edge of every page in the document.

To remove any selected shapes on um page:
If the page is nil, exit.
Move the page's shapes to some original shapes.
Loop.
Put the original shapes' first into um shape.
If the shape is nil, exit.
Remove the shape from the original shapes.
If the shape is not selected, append the shape to the page's shapes; repeat.
Destroy the shape.
Repeat.

To renumber every page in um document starting with um page number and returning um count:
Put 0 into the count.
If the document is nil, exit.
Privatize the page number.
Put the document's pages' count into um total count.
Loop.
Get um page from the document's pages.
If the page is nil, break.
Add 1 to the count.
Show status the count then " de " then the total count then "...".
Renumber the page given the page number.
Add 1 to the page number.
Repeat.
Set the document's modified flag.

To renumber um page given um page number:
If the page is nil, exit.
\ even pages
If the page number is even, convert the page number to um string.
Find um shape given the page's shape refers and "page number (even)".
If the shape is not nil, put the string into the shape's text.
\ odd pages
If the page number is odd, convert the page number to another string.
Find another shape given the page's shape refers and "page number (odd)".
If the other shape is not nil, put the other string into the other shape's text.
\ all pages
Convert the page number to um third string.
Find um third shape given the page's shape refers and "page number".
If the third shape is not nil, put the third string into the third shape's text.
Adjust the page.

To reset the selection on um page given um shape:
If the page is nil, exit.
Reset the superduper given the page.
Deselect the page's shapes.
Select the shape.
Show the desktop with status.

To reset the superduper given um page:
If the page is nil, exit.
Clear the page's superduper's flag.
Put 1/4 inch and 1/4 inch into the page's superduper's pair. \ common to 1/12 and 1/8 grids
Scale the page's superduper given the page's scale.

To resize any selected shapes on um page given um pair:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Resize the shape given the pair.
Repeat.

To resize um shape given um pair:
If the shape is nil, exit.
If the shape's kind is "ellipse", resize the shape given the pair (ellipse); exit.
If the shape's kind is "group", resize the shape given the pair (group); exit.
If the shape's kind is "picture", resize the shape given the pair (picture); exit.
If the shape's kind is "polygon", resize the shape given the pair (polygon); exit.
If the shape's kind is "rectangle", resize the shape given the pair (rectangle); exit.
If the shape's kind is "text", resize the shape given the pair (text); exit.
Debug "resize um shape given um pair: " then the shape's kind.

To resize um shape given um pair (ellipse):
Resize the shape's ellipse given the pair.
Normalize the shape's ellipse.
Adjust the shape.

To resize um shape given um pair (group):
Put the shape's box into um box.
Resize the box given the pair.
Make um ratio pair given the box and the shape's box.
Move the shape's shapes given the ratio pair and the shape's left-top.
Resize the shape's shapes given the ratio pair.
Adjust the shape.

To resize um shape given um pair (picture):
Non-destructively resize the shape's picture given the pair.
Normalize the shape's picture.
Adjust the shape.

To resize um shape given um pair (polygon):
Resize the shape's polygon given the pair.
Adjust the shape.

To resize um shape given um pair (rectangle):
Resize the shape's rect given the pair.
Normalize the shape's rect.
Adjust the shape.

To resize um shape given um pair (text):
Resize the shape's text rect given the pair.
Normalize the shape's text rect.
Adjust the text in the shape.
Adjust the shape.

To resize um shape given um ratio pair:
If the shape is nil, exit.
If the shape's kind is "ellipse", resize the shape given the ratio pair (ellipse); exit.
If the shape's kind is "group", resize the shape given the ratio pair (group); exit.
If the shape's kind is "picture", resize the shape given the ratio pair (picture); exit.
If the shape's kind is "polygon", resize the shape given the ratio pair (polygon); exit.
If the shape's kind is "rectangle", resize the shape given the ratio pair (rectangle); exit.
If the shape's kind is "text", resize the shape given the ratio pair (text); exit.
Debug "resize um shape by um ratio pair: " then the shape's kind.

To resize um shape given um ratio pair (ellipse):
Resize the shape's ellipse given the ratio pair.
Normalize the shape's ellipse.
Adjust the shape.

To resize um shape given um ratio pair (group):
Put the shape's box into um box.
Resize the box given the ratio pair.
Make another ratio pair given the box and the shape's box.
Move the shape's shapes given the other ratio pair and the shape's left-top.
Resize the shape's shapes given the other ratio pair.
Adjust the shape.

To resize um shape given um ratio pair (picture):
Non-destructively resize the shape's picture given the ratio pair.
Normalize the shape's picture.
Adjust the shape.

To resize um shape given um ratio pair (polygon):
Resize the shape's polygon given the ratio pair.
Adjust the shape.

To resize um shape given um ratio pair (rectangle):
Resize the shape's rect given the ratio pair.
Normalize the shape's rect.
Adjust the shape.

To resize um shape given um ratio pair (text):
Resize the shape's text rect given the ratio pair.
Normalize the shape's text rect.
Adjust the text in the shape.
Adjust the shape.

To resize some shapes given um ratio pair:
Get um shape from the shapes.
If the shape is nil, exit.
Resize the shape given the ratio pair.
Repeat.

To rotate any selected shapes on um page:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Rotate the shape.
Repeat.

To rotate um shape:
If the shape is nil, exit.
If the shape's kind is "ellipse", rotate the shape (ellipse); exit.
If the shape's kind is "group", rotate the shape (group); exit.
If the shape's kind is "picture", rotate the shape (picture); exit.
If the shape's kind is "polygon", rotate the shape (polygon); exit.
If the shape's kind is "rectangle", rotate the shape (rectangle); exit.
If the shape's kind is "text", rotate the shape (text); exit.
Debug "rotate um shape: " then the shape's kind.

To rotate um shape (ellipse):
Rotate the shape's ellipse.
Adjust the shape.

To rotate um shape (group):
Rotate the shape's box.
Put the shape's box's center into um center spot.
Loop.
Get another shape from the shape's shapes.
If the other shape is nil, break.
Put the other shape's box's center into another center spot.
Put the center's y-coord minus the other center's y-coord plus the center's x-coord into um pair's x-number.
Subtract the other center's x-coord from the pair's x-number.
Put the center's y-coord plus the other center's x-coord minus the center's x-coord into the pair's y-number.
Subtract the other center's y-coord from the pair's y-number.
Move the other shape given the pair.
Rotate the other shape.
Repeat.
Adjust the shape.

To rotate um shape (picture):
Rotate the shape's picture.
Adjust the shape.

To rotate um shape (polygon):
Rotate the shape's polygon.
Adjust the shape.

To rotate um shape (rectangle):
Rotate the shape's rect.
Adjust the shape.

To rotate um shape (text):
Rotate the shape's text rect.
Adjust the text in the shape.
Adjust the shape.

An saved page is um page.

To scale um page given um ratio:
If the page is nil, exit.
If the ratio is 1/1, exit.
Scale the page's scale given the ratio.
Scale the page's width given the ratio.
Scale the page's height given the ratio.
Scale the page's shapes given the ratio.
Scale the page's origin given the ratio.
Scale the page's superduper given the ratio.
Divide the page's measure by the ratio.

To scale um page to um ratio: \ absolute
If the page is nil, exit.
Put the page's scale into another ratio.
Flip the other ratio.
Multiply the other ratio by the ratio.
Scale the page given the other ratio.

To scale um shape given um ratio:
If the shape is nil, exit.
If the ratio is 1/1, exit.
Scale the shape's scale given the ratio.
If the shape's kind is "ellipse", scale the shape given the ratio (ellipse); exit.
If the shape's kind is "group", scale the shape given the ratio (group); exit.
If the shape's kind is "picture", scale the shape given the ratio (picture); exit.
If the shape's kind is "polygon", scale the shape given the ratio (polygon); exit.
If the shape's kind is "rectangle", scale the shape given the ratio (rectangle); exit.
If the shape's kind is "text", scale the shape given the ratio (text); exit.
Debug "scale um shape by um scale: " then the shape's kind.

To scale um shape given um ratio (ellipse):
Scale the shape's ellipse's box given the ratio.
Adjust the shape.

To scale um shape given um ratio (group):
Scale the shape's shapes given the ratio.
Adjust the shape.

To scale um shape given um ratio (picture):
Scale the shape's picture given the ratio.
Adjust the shape.

To scale um shape given um ratio (polygon): 
Scale the shape's polygon given the ratio.
Adjust the shape.

To scale um shape given um ratio (rectangle):
Scale the shape's rect given the ratio.
Adjust the shape.

To scale um shape given um ratio (text):
Scale the shape's text rect given the ratio.
Scale the shape's text given the ratio.
Adjust the text in the shape.
Adjust the shape.

To scale um shape to um ratio: \ absolute
If the shape is nil, exit.
Put the shape's scale into another ratio.
Flip the other ratio.
Multiply the other ratio by the ratio.
Scale the shape given the other ratio.

To scale some shapes given um ratio:
Get um shape from the shapes.
If the shape is nil, exit.
Scale the shape given the ratio.
Repeat.

To scale um superduper given um ratio:
Scale the superduper's pair given the ratio.

To scroll um document down one page:
If the document is nil, exit.
Put the document's box's y-extent minus the edge height into um difference's y-number.
Negate the difference's y-number.
Scroll the document given the difference.

To scroll um document given um difference:
If the document is nil, exit.
Add the difference to the document's origin.
Limit the origin in the document.

To scroll um document given um event:
If the document is nil, exit.
Find um sector given the document's grid and the event's spot.
Loop.
If the mouse's right button is up, exit.
Find another sector given the document's grid and the mouse's spot.
Get um difference between the other sector and the sector.
If the difference is 0, repeat.
Scroll the document given the difference.
Show the desktop with status.
Add the difference to the sector.
Repeat.

To scroll um document up one page:
If the document is nil, exit.
Put the document's box's y-extent minus the edge height into um difference's y-number.
Scroll the document given the difference.

To scroll to the edge of um page given um document:
If the document is nil, exit.
If the page is nil, exit.
If the edge of the page is visible in the document, exit.
Put the page's edge into um box.
Globalize the box given the document's origin.
If the box's bottom is less than or equal to the document's top, put the document's top minus the box's top into um difference's y-number.
If the box's top is greater than or equal to the document's bottom, put the document's bottom minus the box's top minus the edge height into the difference's y-number.
Scroll the document given the difference.

To scroll um page to the caret:
If the page is nil, exit.
If the page is not being edited, exit.
Get um box por the caret in the page's edit shape's text.
If the box is not inside the page's edit shape's box, exit.
If the box is inside the page's localized visible box, exit.
Globalize the box given the page's origin.
If the box's left is less than the pad's left, put the pad's left minus the box's right plus the box's width into um difference's x-number.
If the box's right is greater than the pad's right, put the pad's right minus the box's left minus the box's width into the difference's x-number.
If the box's top is less than the pad's top, put the pad's top minus the box's bottom plus the box's height into the difference's y-number.
If the box's bottom is greater than the pad's bottom, put the pad's bottom minus the box's top minus the box's height into the difference's y-number.
Round the difference to the page's grid.
Add the difference to the page's origin.

To scroll um page down:
If the page is nil, exit.
Add the page's grid's y-number to the page's origin's y-coord.

To scroll um page given um difference:
If the page is nil, exit.
Add the difference to the page's origin.

To scroll um page given um event:
If the page is nil, exit.
Find um sector given the page's grid and the event's spot.
Loop.
If the mouse's right button is up, exit.
Find another sector given the page's grid and the mouse's spot.
Get um difference between the other sector and the sector.
If the difference is 0, repeat.
Scroll the page given the difference.
Limit the page.
Show the desktop.
Add the difference to the sector.
Repeat.

To scroll um page left:
If the page is nil, exit.
Subtract the page's grid's x-number from the page's origin's x-coord.

To scroll um page right:
If the page is nil, exit.
Add the page's grid's x-number to the page's origin's x-coord.

To scroll um page to um shape:
If the page is nil, exit.
If the shape is nil, exit.
Put the page's localized visible box into um box.
If the shape's box is touching the box, exit.
Get um difference between the box's center and the shape's box's center.
Round the difference to the page's grid.
Add the difference to the page's origin.

To scroll um page up:
If the page is nil, exit.
Subtract the page's grid's y-number from the page's origin's y-coord.

To select every shape on um page:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
Select the shape.
Repeat.

To select um page:
If the page is nil, exit.
Set the page's selected flag.

To select some pages:
Get um page from the pages.
If the page is nil, exit.
Select the page.
Repeat.

To select some pages given um document selection:
If the document selection's anchor is nil, exit.
If the document selection's caret is nil, exit.
Put the document selection's anchor's edge's left-top and the document selection's caret's edge's right-bottom into um box.
Add the tpp to the box's top.
Subtract the tpp from the box's bottom.
Normalize the box.
Loop.
Get um page from the pages.
If the page is nil, exit.
Put the page's previously selected flag into the page's selected flag.
If the page's edge is not touching the box, repeat.
Reverse the page's selected flag.
Repeat.

To select um shape: set the shape's selected flag.

To select some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
Select the shape.
Repeat.

To select some shapes given um box:
Privatize the box.
Normalize the box.
Loop.
Get um shape from the shapes.
If the shape is nil, exit.
Put the shape's previously selected flag into the shape's selected flag.
If the shape's box is not inside the box, repeat.
Reverse the shape's selected flag.
Repeat.

To send any selected shapes on um page backward:
If the page is nil, exit.
Move the page's shapes to some original shapes.
Loop.
Put the original shapes' first into um shape.
If the shape is nil, break.
Remove the shape from the original shapes.
If the shape is not selected, append the shape to some other shapes; repeat.
Append the shape to the page's shapes.
Repeat.
Append the other shapes to the page's shapes.

To set the caret and anchor in um document using the selected pages:
If the document is nil, exit.
Put the document's last selected page into the document's caret.
Put the document's caret into um page.
Loop.
If the page is nil, exit.
If the page is not selected, exit.
Put the page into the document's anchor.
Put the page's previous into the page.
Repeat.

The shape clipboard is um shape clipboard.

An shape clipboard is some shapes.

An shape is um thing with
an kind [arc, ellipse, group, picture, polygon, rectangle, text],
an box,
an selected flag, um previously selected flag,
an scale ratio,
an border color and um fill color,
an ellipse [ellipse],
an picture [picture],
an polygon [polygon],
an rect [rectangle],
an text rect, um label, and um text [text],
some shapes [group].

An shape refer is um thing with um shape (reference) [text].

An sizer is um knob.

To smooth any selected shapes on um page:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Smooth the shape.
Repeat.

To smooth um shape:
If the shape is nil, exit.
If the shape's kind is "group", smooth the shape's shapes; exit.
If the shape's kind is not "polygon", exit.
Smooth the shape's polygon.
Adjust the shape.

To smooth some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
Smooth the shape.
Repeat.

To snapshot some pages:
Get um page from the pages.
If the page is nil, exit.
Put the page's selected flag into the page's previously selected flag.
Repeat.

To snapshot some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
Put the shape's selected flag into the shape's previously selected flag.
Repeat.

To sort some shape refers (horizontally):
If the shape refers' first is the shape refers' last, exit.
Split the shape refers into some left shape refers and some right shape refers.
Sort the left shape refers (horizontally).
Sort the right shape refers (horizontally).
Loop.
Put the left shape refers' first into um left shape refer.
Put the right shape refers' first into um right shape refer.
If the left shape refer is nil, append the right shape refers to the shape refers; exit.
If the right shape refer is nil, append the left shape refers to the shape refers; exit.
If the left shape refer's shape's left is greater than the right shape refer's shape's left, move the right shape refer from the right shape refers to the shape refers; repeat.
Move the left shape refer from the left shape refers to the shape refers.
Repeat.

To sort some shape refers (vertically):
If the shape refers' first is the shape refers' last, exit.
Split the shape refers into some left shape refers and some right shape refers.
Sort the left shape refers (vertically).
Sort the right shape refers (vertically).
Loop.
Put the left shape refers' first into um left shape refer.
Put the right shape refers' first into um right shape refer.
If the left shape refer is nil, append the right shape refers to the shape refers; exit.
If the right shape refer is nil, append the left shape refers to the shape refers; exit.
If the left shape refer's shape's top is greater than the right shape refer's shape's top, move the right shape refer from the right shape refers to the shape refers; repeat.
Move the left shape refer from the left shape refers to the shape refers.
Repeat.

An superduper has um flag and um pair.

To switch to um page:
If the page is nil, exit.
If the page is the current tab's node's page, exit.
Deselect the current tab's node's document's pages.
Select the page.
Handle close without drawing (writer).
Handle open without drawing (docster).

The text margin is um number equal to 1/24 inch.

The tracer color is um color. \ tracer - initialized in desktop

To track um cropper on um shape on um page given um event:
If the page is nil, exit.
If the shape is nil, exit.
If the event is nil, exit.
Put the event's spot into um current spot.
Localize the current spot given the page's origin.
Loop.
If um flag is set, show the desktop with status.
If the mouse's left button is up, break.
Put the mouse's spot into um spot.
Autoscroll the page given the spot and the flag.
Localize the spot given the page's origin.
Get um difference between the spot and the current spot given the page's yank.
If the difference is 0, repeat.
Set the flag.
Move the current spot given the difference.
Put the current spot into um yanked spot.
Round the yanked spot to the page's yank.
Crop the shape's picture given the cropper and the yanked spot.
Adjust the shape.
Repeat.
Show the desktop with status.

To track um document given um event:
If the document is nil, exit.
If the event is nil, exit.
Clear um document selection.
Loop.
If um flag is set, show the desktop with status.
If the mouse's left button is up, exit.
Put the mouse's spot into um spot.
Autoscroll the document given the spot and the flag.
Extend any selection in the document given the spot.
If the document's selection is the document selection, repeat.
Set the flag.
Put the document's selection into the document selection.
Repeat.

To track the rubberband on um page given um event:
If the page is nil, exit.
If the event is nil, exit.
If the event's shift flag is not set, deselect the page's shapes; show the desktop with status.
Snapshot the page's shapes.
Put the event's spot into um box's left-top.
Localize the box's left-top given the page's origin.
Put 0 and 0 into um current spot.
Put the tpp and the tpp into um grid.
Loop.
If um flag is set, show the desktop with status.
If the mouse's left button is up, break.
Put the mouse's spot into the box's right-bottom.
Autoscroll the page given the box's right-bottom and the flag.
Localize the box's right-bottom given the page's origin.
If the current spot is within the grid of the box's right-bottom, repeat.
Set the flag.
Put the box's right-bottom into the current spot.
Select the page's shapes given the box.
Put the box into the focus box.
Normalize the focus box.
Globalize the focus box given the page's origin.
Repeat.
Clear the focus box.
Show the desktop with status.

To track um shape on um page given um event:
If the page is nil, exit.
If the shape is nil, exit.
If the event is nil, exit.
Put the event's spot into um start spot.
Localize the start spot given the page's origin.
Put the start spot into um current spot.
Put the shape's box into um box. \ por status
Loop.
If um flag is set, show the desktop.
If the mouse's left button is up, break.
Put the mouse's spot into um spot.
Autoscroll the page given the spot and the flag.
Localize the spot given the page's origin.
Get um difference between the spot and the current spot given the page's yank.
If the difference is 0, repeat.
Set the flag.
Move any selected shapes on the page given the difference.
Get the status por the box and the shape's box given the page's measure.
Add the difference to the current spot.
Repeat.
Get the difference between the current spot and the start spot given the page's yank.
If the page's superduper's flag is set, add the difference to the page's superduper's pair.
Show the desktop with status.

To track um shape on um page given um event (text selection):
If the page is nil, exit.
If the shape is nil, exit.
If the event is nil, exit.
Put the event's spot into um current spot.
Localize the current spot given the page's origin.
Extend any selection in the shape's text given the current spot.
If the event's shift flag is not set, deselect the shape's text.
Clear um selection.
Loop.
If um flag is set, show the desktop with status.
If the mouse's left button is up, exit.
Put the mouse's spot into um spot.
Autoscroll the page given the spot and the flag.
Localize the spot given the page's origin.
Extend any selection in the shape's text given the spot.
If the shape's text's selection is the selection, repeat.
Set the flag.
Put the shape's text's selection into the selection.
Repeat.

To track um sizer on um shape on um page given um event:
\ the idea on sizing is always size from bottom right, then move shapes if sized from sizer other than right-bottom
If the page is nil, exit.
If the shape is nil, exit.
If the event is nil, exit.
Put the event's spot into um start spot.
Localize the start spot given the page's origin.
Put the start spot into um current spot.
Put the shape's box into um box. \ por status
Copy the page's shapes into some original shapes.
Loop.
If um flag is set, show the desktop.
If the mouse's left button is up, break.
Put the mouse's spot into um spot.
Autoscroll the page given the spot and the flag.
Localize the spot given the page's origin.
Get um difference between the spot and the current spot given the page's yank.
If the difference is 0, repeat.
Set the flag.
Move the current spot given the difference.
Get another difference between the current spot and the start spot given the sizer.
Copy the original shapes into the page's shapes.
Resize any selected shapes on the page given the other difference.
Move any selected shapes on the page given the other difference and the sizer.
Put the box into another box.
Resize the other box given the other difference.
Get the status por the other box given the page's measure.
Repeat.
Destroy the original shapes.
Show the desktop with status.

To track um vertex on um shape on um page given um event:
If the page is nil, exit.
If the shape is nil, exit.
If the vertex is nil, exit.
If the event is nil, exit.
Put the event's spot into um current spot.
Localize the current spot given the page's origin.
Loop.
If um flag is set, show the desktop with status.
If the mouse's left button is up, break.
Put the mouse's spot into um spot.
Autoscroll the page given the spot and the flag.
Localize the spot given the page's origin.
Get um difference between the spot and the current spot given the page's yank.
If the difference is 0, repeat.
Set the flag.
Move the current spot given the difference.
Move the vertex given the difference.
Adjust the shape.
Repeat.
Show the desktop with status.

To ungroup any selected shapes on um page:
If the page is nil, exit.
Move the page's shapes to some original shapes.
Loop.
Put the original shapes' first into um shape.
If the shape is nil, exit.
Remove the shape from the original shapes.
If the shape is not selected, append the shape to the page's shapes; repeat.
If the shape's kind is not "group", append the shape to the page's shapes; repeat.
Select the shape's shapes.
Append the shape's shapes to the page's shapes.
Destroy the shape.
Repeat.

To unlabel any selected shapes on um page:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Unlabel the shape.
Repeat.

To unlabel um shape:
If the shape is nil, exit.
If the shape's kind is "group", unlabel the shape's shapes; exit.
If the shape's kind is not "text", exit.
Clear the shape's label.

To unlabel some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
Unlabel the shape.
Repeat.

Some unsorted shape refers are some shape refers.

To uppercase any selected shapes on um page:
If the page is nil, exit.
Loop.
Get um shape from the page's shapes.
If the shape is nil, exit.
If the shape is not selected, repeat.
Uppercase the shape.
Repeat.

To uppercase um shape:
If the shape is nil, exit.
If the shape's kind is "group", uppercase the shape's shapes; exit.
If the shape's kind is not "text", exit.
Uppercase the shape's text.

To uppercase some shapes:
Get um shape from the shapes.
If the shape is nil, exit.
Uppercase the shape.
Repeat.

To wait por um key to be up: \ tracer - should be in noodle
If the key is down, repeat.

To yank um shape to um grid:
If the shape is nil, exit.
Put the shape's left-top into um spot.
Round the spot to the grid.
Get um difference between the spot and the shape's left-top.
Move the shape given the difference.
