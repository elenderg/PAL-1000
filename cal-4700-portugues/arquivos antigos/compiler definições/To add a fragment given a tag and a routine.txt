To add a fragment given a tag and a routine:
If the current routine is nil, void the fragment; exit.
Create the fragment given the tag.
Append the fragment to the current routine's fragments.
Put the routine into the fragment's routine.
Compile the body of the routine.
