To handle undo:
If the current tab's mode is "editor", handle undo given the current tab's node's source; exit.
If the current tab's mode is "writer", handle undo given the current tab's node's page; exit.
Cluck.
